{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///cornerstoneWADOImageLoader.min.js","webpack:///webpack/bootstrap 012e4b744080ee5fc464","webpack:///external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}","webpack:///external {\"commonjs\":\"cornerstone-core\",\"commonjs2\":\"cornerstone-core\",\"amd\":\"cornerstone-core\",\"root\":\"cornerstone\"}","webpack:///./imageLoader/internal/index.js","webpack:///./version.js","webpack:///./imageLoader/wadors/metaData/getValue.js","webpack:///./imageLoader/wadouri/parseImageId.js","webpack:///external {\"commonjs\":\"dicom-parser\",\"commonjs2\":\"dicom-parser\",\"amd\":\"dicom-parser\",\"root\":\"dicomParser\"}","webpack:///./imageLoader/createImage.js","webpack:///./imageLoader/internal/options.js","webpack:///./imageLoader/wadors/metaDataManager.js","webpack:///./imageLoader/wadouri/dataSetCacheManager.js","webpack:///./imageLoader/colorSpaceConverters/index.js","webpack:///./imageLoader/convertColorSpace.js","webpack:///./imageLoader/decodeImageFrame.js","webpack:///./imageLoader/decodeJPEGBaseline8BitColor.js","webpack:///./imageLoader/getImageFrame.js","webpack:///./imageLoader/getMinMax.js","webpack:///./imageLoader/isColorImage.js","webpack:///./imageLoader/isJPEGBaseline8BitColor.js","webpack:///./imageLoader/webWorkerManager.js","webpack:///./imageLoader/wadors/findIndexOfString.js","webpack:///./imageLoader/wadors/getPixelData.js","webpack:///./imageLoader/wadors/metaData/getNumberValue.js","webpack:///./imageLoader/wadors/metaData/getNumberValues.js","webpack:///./imageLoader/wadouri/fileManager.js","webpack:///./imageLoader/wadouri/getEncapsulatedImageFrame.js","webpack:///./imageLoader/wadouri/getUncompressedImageFrame.js","webpack:///./imageLoader/wadouri/loadFileRequest.js","webpack:///./imageLoader/wadouri/metaData/getImagePixelModule.js","webpack:///./imageLoader/wadouri/metaData/getLUTs.js","webpack:///./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","webpack:///./imageLoader/wadouri/metaData/getNumberValues.js","webpack:///./imageLoader/wadouri/unpackBinaryFrame.js","webpack:///./imageLoader/configure.js","webpack:///./imageLoader/wadors/index.js","webpack:///./imageLoader/wadouri/index.js","webpack:///./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","webpack:///./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","webpack:///./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","webpack:///./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","webpack:///./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","webpack:///./imageLoader/index.js","webpack:///./imageLoader/internal/xhrRequest.js","webpack:///./imageLoader/wadors/loadImage.js","webpack:///./imageLoader/wadors/metaData/getNumberString.js","webpack:///./imageLoader/wadors/metaData/index.js","webpack:///./imageLoader/wadors/metaData/metaDataProvider.js","webpack:///./imageLoader/wadors/stringToUint8Array.js","webpack:///./imageLoader/wadors/uint8ArrayToString.js","webpack:///./imageLoader/wadouri/loadImage.js","webpack:///./imageLoader/wadouri/metaData/index.js","webpack:///./imageLoader/wadouri/metaData/metaDataProvider.js"],"names":["root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_0__","__WEBPACK_EXTERNAL_MODULE_1__","__WEBPACK_EXTERNAL_MODULE_6__","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","internal","xhrRequest","getOptions","setOptions","undefined","_xhrRequest","_xhrRequest2","obj","default","_options","element","index","arguments","length","defaultValue","Value","imageId","firstColonIndex","indexOf","url","substring","frameIndex","frame","frameStr","substr","parseInt","scheme","_interopRequireDefault","isModalityLUTForDisplay","sopClassUid","setPixelDataType","imageFrame","bitsAllocated","pixelRepresentation","pixelData","Uint16Array","Int16Array","Uint8Array","transferSyntax","options","canvas","document","createElement","deferred","_jquery2","Deferred","_getImageFrame2","_decodeImageFrame2","then","imagePlaneModule","cornerstone","metaData","voiLutModule","modalityLutModule","sopCommonModule","color","_isColorImage2","photometricInterpretation","_isJPEGBaseline8BitColor2","height","rows","width","columns","context","getContext","imageData","createImageData","_convertColorSpace2","data","minMax","_getMinMax2","smallestPixelValue","min","largestPixelValue","max","image","intercept","rescaleIntercept","slope","rescaleSlope","invert","minPixelValue","maxPixelValue","render","sizeInBytes","rowPixelSpacing","pixelSpacing","columnPixelSpacing","windowCenter","windowWidth","decodeTimeInMS","getPixelData","renderColorImage","getCanvas","lastImageIdDrawn","putImageData","renderGrayscaleImage","modalityLUTSequence","sopClassUID","modalityLUT","voiLUTSequence","voiLUT","maxVoi","minVoi","resolve","promise","_jquery","_getImageFrame","_decodeImageFrame","_isColorImage","_convertColorSpace","_getMinMax","_isJPEGBaseline8BitColor","_cornerstoneCore","newObj","key","newOptions","beforeSend","imageCreated","strict","add","metadata","imageIds","remove","purge","isLoaded","uri","loadedDataSets","Error","dataSet","load","loadRequest","alreadyLoadedpromise","cacheCount","promises","loadDeferred","dicomPart10AsArrayBuffer","byteArray","dicomParser","parseDicom","error","reject","always","unload","_dicomParser","_internal","_convertRGBColorByPixel","_convertRGBColorByPlane","_convertYBRFullByPixel","_convertYBRFullByPlane","_convertPALETTECOLOR","convertRGB","rgbaBuffer","planarConfiguration","_colorSpaceConverters","convertRGBColorByPixel","convertRGBColorByPlane","convertYBRFull","convertYBRFullByPixel","convertYBRFullByPlane","convertColorSpace","convertPALETTECOLOR","addDecodeTask","priority","transferList","transferPixelData","buffer","_webWorkerManager2","addTask","decodeImageFrame","samplesPerPixel","_decodeJPEGBaseline8BitColor2","_webWorkerManager","_decodeJPEGBaseline8BitColor","arrayBufferToString","binaryToString","String","fromCharCode","apply","Array","slice","binary","decodeURIComponent","escape","_error","URIError","start","Date","getTime","imgBlob","Blob","type","r","FileReader","readAsBinaryString","readAsArrayBuffer","onload","img","Image","drawImage","getImageData","end","onerror","src","window","btoa","result","imagePixelModule","redPaletteColorLookupTableDescriptor","greenPaletteColorLookupTableDescriptor","bluePaletteColorLookupTableDescriptor","redPaletteColorLookupTableData","greenPaletteColorLookupTableData","bluePaletteColorLookupTableData","storedPixelData","numPixels","storedPixel","Math","startTaskOnWebWorker","tasks","webWorkers","status","task","shift","statistics","totalTimeDelayedInMS","added","worker","postMessage","taskType","workerIndex","numTasksExecuting","config","maxWebWorkers","spawnWebWorker","handleMessageFromWorker","msg","numTasksCompleted","totalTaskTimeInMS","Worker","webWorkerPath","push","addEventListener","initialize","configObject","defaultConfig","navigator","hardwareConcurrency","startWebWorkersOnDemand","loadWebWorkerTask","sourcePath","taskConfig","webWorkerTaskPaths","taskConfiguration","assign","taskId","nextTaskId","splice","setTaskPriority","cancelTask","reason","getStatistics","numWebWorkers","numTasksQueued","decodeTask","loadCodecsOnStartup","initializeCodecsOnStartup","codecsPath","usePDFJS","checkToken","token","dataOffset","endIndex","findIndexOfString","str","offset","_stringToUint8Array2","_stringToUint8Array","findBoundary","header","findContentType","trim","mediaType","headers","accept","imageFrameAsArrayBuffer","response","tokenIndex","_findIndexOfString2","_uint8ArrayToString2","split","boundary","contentType","_findIndexOfString","_uint8ArrayToString","_getValue2","parseFloat","_getValue","minimumLength","values","file","files","framesAreFragmented","intString","elements","x7fe00010","fragments","getEncapsulatedImageFrame","basicOffsetTable","readEncapsulatedImageFrame","createJPEGBasicOffsetTable","readEncapsulatedPixelDataFromFragments","pixelDataElement","uint16","pixelDataOffset","pixelsPerFrame","frameOffset","_unpackBinaryFrame2","_unpackBinaryFrame","parsedImageId","_parseImageId2","fileIndex","_fileManager2","fileReader","e","target","_parseImageId","_fileManager","getLutDescriptor","tag","getLutData","lutDataSet","lutDescriptor","lut","lutData","numLutEntries","populatePaletteColorLut","x00281101","populateSmallestLargestPixelValues","int16","getImagePixelModule","string","bitsStored","highBit","pixelAspectRatio","getLUT","numLUTEntries","firstValueMapped","numBitsPerEntry","id","getLUTs","lutSequence","items","luts","getMinStoredPixelValue","getModalityLUTOutputPixelRepresentation","floatString","x00283000","getNumberValues","valueAsString","isBitSet","byte","bitPos","Boolean","bytePos","floor","_metaData","_getPixelData","_getPixelData2","_metaDataManager","_metaDataManager2","_loadImage","_loadImage2","getNumberString","getNumberValue","getValue","metaDataProvider","loadImage","metaDataManager","_dataSetCacheManager","_dataSetCacheManager2","_getEncapsulatedImageFrame","_getEncapsulatedImageFrame2","_getUncompressedImageFrame","_getUncompressedImageFrame2","_loadFileRequest","_loadFileRequest2","dataSetCacheManager","fileManager","getUncompressedImageFrame","loadFileRequest","loadImageFromPromise","getLoaderForScheme","parseImageId","unpackBinaryFrame","palIndex","rgbaIndex","rData","gData","bData","len","rgbIndex","rIndex","gIndex","bIndex","ybrIndex","y","cb","cr","yIndex","cbIndex","crIndex","keys","forEach","_wadouri","_wadors","_configure","_createImage","_version","xhr","XMLHttpRequest","open","responseType","setRequestHeader","onreadystatechange","readyState","onprogress","oProgress","lengthComputable","loaded","total","percentComplete","round","events","trigger","send","getTransferSyntaxForContentType","_createImage2","loadTimeInMS","fail","registerImageLoader","_getNumberString","_getNumberValue","_getNumberValues","_metaDataProvider","_interopRequireWildcard","modality","seriesInstanceUID","seriesNumber","_getNumberValue2","studyInstanceUID","seriesDate","parseDA","seriesTime","parseTM","patientAge","patientSize","patientWeight","_getNumberValues2","imageOrientationPatient","imagePositionPatient","sliceThickness","sliceLocation","rescaleType","sopInstanceUID","radiopharmaceuticalInfo","radiopharmaceuticalStartTime","radionuclideTotalDose","radionuclideHalfLife","addProvider","uint","j","charCodeAt","addDecache","decache","encapsulatedPixelData","dataSetPromise","loadEnd","totalTimeInMS","loader","_getImagePixelModule","_getLUTs","_getModalityLUTOutputPixelRepresentation","frameOfReferenceUID","_getImagePixelModule2","_getLUTs2","modalityLUTOutputPixelRepresentation","_getModalityLUTOutputPixelRepresentation2","x00283010","x00540016","firstRadiopharmaceuticalInfoDataSet"],"mappings":"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","file":"cornerstoneWADOImageLoader.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstoneWADOImageLoader\", [\"jquery\", \"cornerstone-core\", \"dicom-parser\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstoneWADOImageLoader\"] = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse\n\t\troot[\"cornerstoneWADOImageLoader\"] = factory(root[\"$\"], root[\"cornerstone\"], root[\"dicomParser\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_6__) {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition","/*! cornerstone-wado-image-loader - 0.14.6 - 2017-08-31 | (c) 2016 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */\n(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"cornerstoneWADOImageLoader\", [\"jquery\", \"cornerstone-core\", \"dicom-parser\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"cornerstoneWADOImageLoader\"] = factory(require(\"jquery\"), require(\"cornerstone-core\"), require(\"dicom-parser\"));\n\telse\n\t\troot[\"cornerstoneWADOImageLoader\"] = factory(root[\"$\"], root[\"cornerstone\"], root[\"dicomParser\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_0__, __WEBPACK_EXTERNAL_MODULE_1__, __WEBPACK_EXTERNAL_MODULE_6__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 45);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.internal = exports.xhrRequest = exports.getOptions = exports.setOptions = undefined;\n\nvar _xhrRequest = __webpack_require__(46);\n\nvar _xhrRequest2 = _interopRequireDefault(_xhrRequest);\n\nvar _options = __webpack_require__(8);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar internal = {\n  xhrRequest: _xhrRequest2.default,\n  setOptions: _options.setOptions,\n  getOptions: _options.getOptions\n};\n\nexports.setOptions = _options.setOptions;\nexports.getOptions = _options.getOptions;\nexports.xhrRequest = _xhrRequest2.default;\nexports.internal = internal;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = '0.14.6';\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element) {\n  var index = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  var defaultValue = arguments[2];\n\n  if (!element) {\n    return defaultValue;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return defaultValue;\n  }\n  // make sure we have the specified index\n  if (element.Value.length <= index) {\n    return defaultValue;\n  }\n\n  return element.Value[index];\n};\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageId) {\n  var firstColonIndex = imageId.indexOf(':');\n  var url = imageId.substring(firstColonIndex + 1);\n  var frameIndex = url.indexOf('frame=');\n  var frame = void 0;\n\n  if (frameIndex !== -1) {\n    var frameStr = url.substr(frameIndex + 6);\n\n    frame = parseInt(frameStr, 10);\n    url = url.substr(0, frameIndex - 1);\n  }\n\n  return {\n    scheme: imageId.substr(0, firstColonIndex),\n    url: url,\n    frame: frame\n  };\n};\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageId, pixelData, transferSyntax, options) {\n  var canvas = document.createElement('canvas');\n  var deferred = _jquery2.default.Deferred();\n  var imageFrame = (0, _getImageFrame2.default)(imageId);\n  var decodePromise = (0, _decodeImageFrame2.default)(imageFrame, transferSyntax, pixelData, canvas, options);\n\n  decodePromise.then(function (imageFrame) {\n    // var imagePixelModule = metaDataProvider('imagePixelModule', imageId);\n    var imagePlaneModule = cornerstone.metaData.get('imagePlaneModule', imageId) || {};\n    var voiLutModule = cornerstone.metaData.get('voiLutModule', imageId) || {};\n    var modalityLutModule = cornerstone.metaData.get('modalityLutModule', imageId) || {};\n    var sopCommonModule = cornerstone.metaData.get('sopCommonModule', imageId) || {};\n    var color = (0, _isColorImage2.default)(imageFrame.photometricInterpretation);\n\n    // JPEGBaseline (8 bits) is already returning the pixel data in the right format (rgba)\n    // because it's using a canvas to load and decode images.\n    if (!(0, _isJPEGBaseline8BitColor2.default)(imageFrame, transferSyntax)) {\n      setPixelDataType(imageFrame);\n\n      // convert color space\n      if (color) {\n        // setup the canvas context\n        canvas.height = imageFrame.rows;\n        canvas.width = imageFrame.columns;\n\n        var context = canvas.getContext('2d');\n        var imageData = context.createImageData(imageFrame.columns, imageFrame.rows);\n\n        (0, _convertColorSpace2.default)(imageFrame, imageData);\n        imageFrame.imageData = imageData;\n        imageFrame.pixelData = imageData.data;\n\n        // calculate smallest and largest PixelValue of the converted pixelData\n        var minMax = (0, _getMinMax2.default)(imageFrame.pixelData);\n\n        imageFrame.smallestPixelValue = minMax.min;\n        imageFrame.largestPixelValue = minMax.max;\n      }\n    }\n\n    var image = {\n      imageId: imageId,\n      color: color,\n      columns: imageFrame.columns,\n      rows: imageFrame.rows,\n      width: imageFrame.columns,\n      height: imageFrame.rows,\n      intercept: modalityLutModule.rescaleIntercept || 0,\n      slope: modalityLutModule.rescaleSlope || 1,\n      invert: imageFrame.photometricInterpretation === 'MONOCHROME1',\n      minPixelValue: imageFrame.smallestPixelValue,\n      maxPixelValue: imageFrame.largestPixelValue,\n      render: undefined, // set below\n      sizeInBytes: imageFrame.pixelData.length,\n      rowPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[0] : undefined,\n      columnPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[1] : undefined,\n      windowCenter: voiLutModule.windowCenter ? voiLutModule.windowCenter[0] : undefined,\n      windowWidth: voiLutModule.windowWidth ? voiLutModule.windowWidth[0] : undefined,\n      decodeTimeInMS: imageFrame.decodeTimeInMS\n    };\n\n    // add function to return pixel data\n    image.getPixelData = function () {\n      return imageFrame.pixelData;\n    };\n\n    // Setup the renderer\n    if (image.color) {\n      image.render = cornerstone.renderColorImage;\n      image.getCanvas = function () {\n        if (lastImageIdDrawn === imageId) {\n          return canvas;\n        }\n\n        canvas.height = image.rows;\n        canvas.width = image.columns;\n        var context = canvas.getContext('2d');\n\n        context.putImageData(imageFrame.imageData, 0, 0);\n        lastImageIdDrawn = imageId;\n\n        return canvas;\n      };\n    } else {\n      image.render = cornerstone.renderGrayscaleImage;\n    }\n\n    // Modality LUT\n    if (modalityLutModule.modalityLUTSequence && modalityLutModule.modalityLUTSequence.length > 0 && isModalityLUTForDisplay(sopCommonModule.sopClassUID)) {\n      image.modalityLUT = modalityLutModule.modalityLUTSequence[0];\n    }\n\n    // VOI LUT\n    if (voiLutModule.voiLUTSequence && voiLutModule.voiLUTSequence.length > 0) {\n      image.voiLUT = voiLutModule.voiLUTSequence[0];\n    }\n\n    // set the ww/wc to cover the dynamic range of the image if no values are supplied\n    if (image.windowCenter === undefined || image.windowWidth === undefined) {\n      if (image.color) {\n        image.windowWidth = 255;\n        image.windowCenter = 128;\n      } else {\n        var maxVoi = image.maxPixelValue * image.slope + image.intercept;\n        var minVoi = image.minPixelValue * image.slope + image.intercept;\n\n        image.windowWidth = maxVoi - minVoi;\n        image.windowCenter = (maxVoi + minVoi) / 2;\n      }\n    }\n    deferred.resolve(image);\n  });\n\n  return deferred.promise();\n};\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _getImageFrame = __webpack_require__(15);\n\nvar _getImageFrame2 = _interopRequireDefault(_getImageFrame);\n\nvar _decodeImageFrame = __webpack_require__(13);\n\nvar _decodeImageFrame2 = _interopRequireDefault(_decodeImageFrame);\n\nvar _isColorImage = __webpack_require__(17);\n\nvar _isColorImage2 = _interopRequireDefault(_isColorImage);\n\nvar _convertColorSpace = __webpack_require__(12);\n\nvar _convertColorSpace2 = _interopRequireDefault(_convertColorSpace);\n\nvar _getMinMax = __webpack_require__(16);\n\nvar _getMinMax2 = _interopRequireDefault(_getMinMax);\n\nvar _isJPEGBaseline8BitColor = __webpack_require__(18);\n\nvar _isJPEGBaseline8BitColor2 = _interopRequireDefault(_isJPEGBaseline8BitColor);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar lastImageIdDrawn = '';\n\n/**\n * Check whether the modality LUT is meant to be used for display purposes\n * For XA and XRF images, the modality LUT is not meant to be used.\n *\n * See https://groups.google.com/forum/#!searchin/comp.protocols.dicom/Modality$20LUT$20XA/comp.protocols.dicom/UBxhOZ2anJ0/D0R_QP8V2wIJ\n *\n * @param {String} sopClassUid\n * @return {boolean} Whether or not the Modality LUT should be used for image display\n */\nfunction isModalityLUTForDisplay(sopClassUid) {\n  return sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.1' && // XA\n  sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.2.1'; // XRF\n}\n\n/**\n * Helper function to set pixel data to the right typed array.  This is needed because web workers\n * can transfer array buffers but not typed arrays\n * @param imageFrame\n */\nfunction setPixelDataType(imageFrame) {\n  if (imageFrame.bitsAllocated === 16) {\n    if (imageFrame.pixelRepresentation === 0) {\n      imageFrame.pixelData = new Uint16Array(imageFrame.pixelData);\n    } else {\n      imageFrame.pixelData = new Int16Array(imageFrame.pixelData);\n    }\n  } else {\n    imageFrame.pixelData = new Uint8Array(imageFrame.pixelData);\n  }\n}\n\n/**\n * Create an Image\n *\n * @param {String} imageId\n * @param {Array} pixelData\n * @param {String} transferSyntax\n * @param {Object} options\n *\n * @returns {Promise}\n */\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.setOptions = setOptions;\nexports.getOptions = getOptions;\nvar options = {\n  // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\n  beforeSend: function beforeSend() /* xhr */{},\n\n  // callback allowing modification of newly created image objects\n  imageCreated: function imageCreated() /* image */{},\n\n  strict: true\n};\n\nfunction setOptions(newOptions) {\n  options = newOptions;\n}\n\nfunction getOptions() {\n  return options;\n}\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n// TODO: Is this being used at all???\nvar imageIds = [];\n\nfunction add(imageId, metadata) {\n  imageIds[imageId] = metadata;\n}\n\nfunction get(imageId) {\n  return imageIds[imageId];\n}\n\nfunction remove(imageId) {\n  imageIds[imageId] = undefined;\n}\n\nfunction purge() {\n  imageIds = [];\n}\n\nexports.default = {\n  add: add,\n  get: get,\n  remove: remove,\n  purge: purge\n};\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nvar _internal = __webpack_require__(2);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * This object supports loading of DICOM P10 dataset from a uri and caching it so it can be accessed\n * by the caller.  This allows a caller to access the datasets without having to go through cornerstone's\n * image loader mechanism.  One reason a caller may need to do this is to determine the number of frames\n * in a multiframe sop instance so it can create the imageId's correctly.\n */\nvar loadedDataSets = {};\nvar promises = {};\n\n/**\n * Returns true if the wadouri for the specified index has been loaded\n *\n * @param uri\n * @return {boolean} Whether or not the DataSet is in the cache\n */\nfunction isLoaded(uri) {\n  return loadedDataSets[uri] !== undefined;\n}\n\n/**\n * Retrieve a loaded DataSet from the cache\n *\n * @param {String} uri\n * @return {DataSet}\n * @throws If the DataSet is not in the cache\n */\nfunction get(uri) {\n  // if already loaded return it right away\n  if (!loadedDataSets[uri]) {\n    throw new Error('dataSetCacheManager.get: DataSet has not been loaded yet');\n  }\n\n  return loadedDataSets[uri].dataSet;\n}\n\n/**\n * Loads the dicom dataset from the wadouri sp\n *\n * @param {String} uri\n * @param loadRequest\n * @param {String} imageId\n * @return {*}\n */\nfunction load(uri, loadRequest, imageId) {\n  loadRequest = loadRequest || _internal.xhrRequest;\n\n  // if already loaded return it right away\n  if (loadedDataSets[uri]) {\n    // console.log('using loaded dataset ' + uri);\n    var alreadyLoadedpromise = _jquery2.default.Deferred();\n\n    loadedDataSets[uri].cacheCount++;\n    alreadyLoadedpromise.resolve(loadedDataSets[uri].dataSet);\n\n    return alreadyLoadedpromise;\n  }\n\n  // if we are currently loading this uri, return its promise\n  if (promises[uri]) {\n    // console.log('returning existing load promise for ' + uri);\n    return promises[uri];\n  }\n\n  // console.log('loading ' + uri);\n\n  // This uri is not loaded or being loaded, load it via an xhrRequest\n  var promise = loadRequest(uri, imageId);\n\n  // handle success and failure of the XHR request load\n  var loadDeferred = _jquery2.default.Deferred();\n\n  promise.then(function (dicomPart10AsArrayBuffer /* , xhr*/) {\n    var byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\n\n    // Reject the promise if parsing the dicom file fails\n    var dataSet = void 0;\n\n    try {\n      dataSet = dicomParser.parseDicom(byteArray);\n    } catch (error) {\n      loadDeferred.reject(error);\n\n      return;\n    }\n\n    loadedDataSets[uri] = {\n      dataSet: dataSet,\n      cacheCount: 1\n    };\n    loadDeferred.resolve(dataSet);\n    // done loading, remove the promise\n    delete promises[uri];\n  }, function (error) {\n    loadDeferred.reject(error);\n  }).always(function () {\n    // error thrown, remove the promise\n    delete promises[uri];\n  });\n\n  promises[uri] = loadDeferred;\n\n  return loadDeferred;\n}\n\n/**\n * Remove the cached/loaded dicom dataset for the specified wadouri to free up memory\n *\n * @param {String} uri\n */\nfunction unload(uri) {\n  // console.log('unload for ' + uri);\n  if (loadedDataSets[uri]) {\n    loadedDataSets[uri].cacheCount--;\n    if (loadedDataSets[uri].cacheCount === 0) {\n      // console.log('removing loaded dataset for ' + uri);\n      delete loadedDataSets[uri];\n    }\n  }\n}\n\n/**\n * Removes all cached datasets from memory\n */\nfunction purge() {\n  loadedDataSets = {};\n  promises = {};\n}\n\nexports.default = {\n  isLoaded: isLoaded,\n  load: load,\n  unload: unload,\n  purge: purge,\n  get: get\n};\n\n/***/ }),\n/* 11 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _convertRGBColorByPixel = __webpack_require__(41);\n\nObject.defineProperty(exports, 'convertRGBColorByPixel', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertRGBColorByPixel).default;\n  }\n});\n\nvar _convertRGBColorByPlane = __webpack_require__(42);\n\nObject.defineProperty(exports, 'convertRGBColorByPlane', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertRGBColorByPlane).default;\n  }\n});\n\nvar _convertYBRFullByPixel = __webpack_require__(43);\n\nObject.defineProperty(exports, 'convertYBRFullByPixel', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertYBRFullByPixel).default;\n  }\n});\n\nvar _convertYBRFullByPlane = __webpack_require__(44);\n\nObject.defineProperty(exports, 'convertYBRFullByPlane', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertYBRFullByPlane).default;\n  }\n});\n\nvar _convertPALETTECOLOR = __webpack_require__(40);\n\nObject.defineProperty(exports, 'convertPALETTECOLOR', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertPALETTECOLOR).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 12 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = convertColorSpace;\n\nvar _colorSpaceConverters = __webpack_require__(11);\n\n/**\n * Convert an array from RGB color space to RGBA\n *\n * @param {ImageFrame} imageFrame\n * @param {CanvasPixelArray} rgbaBuffer\n */\nfunction convertRGB(imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    (0, _colorSpaceConverters.convertRGBColorByPixel)(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    (0, _colorSpaceConverters.convertRGBColorByPlane)(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\n/**\n * Convert an array from YBRFull color space to RGBA\n *\n * @param {ImageFrame} imageFrame\n * @param {CanvasPixelArray} rgbaBuffer\n */\nfunction convertYBRFull(imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    (0, _colorSpaceConverters.convertYBRFullByPixel)(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    (0, _colorSpaceConverters.convertYBRFullByPlane)(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\n/**\n * Convert the pixel data from the input color space to RGBA\n * based on the photometric interpretation of the image frame.\n *\n * @param {ImageFrame} imageFrame\n * @param {ImageData} imageData\n * @throws If the PhotometricInterpretation has no known color space conversion approach\n */\nfunction convertColorSpace(imageFrame, imageData) {\n  var rgbaBuffer = imageData.data;\n  var photometricInterpretation = imageFrame.photometricInterpretation;\n\n  if (photometricInterpretation === 'RGB') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_RCT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_ICT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'PALETTE COLOR') {\n    (0, _colorSpaceConverters.convertPALETTECOLOR)(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_FULL_422') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_FULL') {\n    convertYBRFull(imageFrame, rgbaBuffer);\n  } else {\n    throw new Error('No color space conversion for photometric interpretation ' + photometricInterpretation);\n  }\n}\n\n/***/ }),\n/* 13 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _webWorkerManager = __webpack_require__(19);\n\nvar _webWorkerManager2 = _interopRequireDefault(_webWorkerManager);\n\nvar _decodeJPEGBaseline8BitColor = __webpack_require__(14);\n\nvar _decodeJPEGBaseline8BitColor2 = _interopRequireDefault(_decodeJPEGBaseline8BitColor);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Add decode task\n *\n * @param imageFrame\n * @param transferSyntax\n * @param pixelData\n * @param options\n *\n * @return {Object}\n */\nfunction addDecodeTask(imageFrame, transferSyntax, pixelData, options) {\n  var priority = options.priority || undefined;\n  var transferList = options.transferPixelData ? [pixelData.buffer] : undefined;\n\n  return _webWorkerManager2.default.addTask('decodeTask', {\n    imageFrame: imageFrame,\n    transferSyntax: transferSyntax,\n    pixelData: pixelData,\n    options: options\n  }, priority, transferList).promise;\n}\n\n/**\n * Decode image frame\n *\n * @param {ImageFrame} imageFrame\n * @param {String} transferSyntax\n * @param {Array} pixelData\n * @param {HTMLCanvasElement} canvas\n * @param {Object} options\n *\n * @return {Object}\n */\nfunction decodeImageFrame(imageFrame, transferSyntax, pixelData, canvas, options) {\n  options = options || {};\n\n  // TODO: Turn this into a switch statement instead\n  if (transferSyntax === '1.2.840.10008.1.2') {\n    // Implicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\n    // Explicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\n    // Explicit VR Big Endian (retired)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\n    // Deflate transfer syntax (deflated by dicomParser)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\n    // RLE Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\n    // JPEG Baseline lossy process 1 (8 bit)\n\n    // Handle 8-bit JPEG Baseline color images using the browser's built-in\n    // JPEG decoding\n    if (imageFrame.bitsAllocated === 8 && (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\n      return (0, _decodeJPEGBaseline8BitColor2.default)(imageFrame, pixelData, canvas);\n    }\n\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\n    // JPEG Lossless, Nonhierarchical (Processes 14)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\n    // JPEG-LS Lossless Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\n    // JPEG 2000 Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\n    // JPEG 2000 Lossy\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  }\n\n  /* Don't know if these work...\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\n   {\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\n   }\n   // JPEG 2000 Part 2 Multicomponent Image Compression\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\n   {\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\n   }\n   */\n\n  throw new Error('No decoder for transfer syntax ' + transferSyntax);\n}\n\nexports.default = decodeImageFrame;\n\n/***/ }),\n/* 14 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, pixelData, canvas) {\n  var start = new Date().getTime();\n  var deferred = _jquery2.default.Deferred();\n\n  var imgBlob = new Blob([pixelData], { type: 'image/jpeg' });\n\n  var r = new FileReader();\n\n  if (r.readAsBinaryString === undefined) {\n    r.readAsArrayBuffer(imgBlob);\n  } else {\n    r.readAsBinaryString(imgBlob); // doesn't work on IE11\n  }\n\n  r.onload = function () {\n    var img = new Image();\n\n    img.onload = function () {\n      canvas.height = img.height;\n      canvas.width = img.width;\n      imageFrame.rows = img.height;\n      imageFrame.columns = img.width;\n      var context = canvas.getContext('2d');\n\n      context.drawImage(this, 0, 0);\n      var imageData = context.getImageData(0, 0, img.width, img.height);\n      var end = new Date().getTime();\n\n      imageFrame.pixelData = imageData.data;\n      imageFrame.imageData = imageData;\n      imageFrame.decodeTimeInMS = end - start;\n      deferred.resolve(imageFrame);\n    };\n    img.onerror = function (error) {\n      deferred.reject(error);\n    };\n    if (r.readAsBinaryString === undefined) {\n      img.src = 'data:image/jpeg;base64,' + window.btoa(arrayBufferToString(r.result));\n    } else {\n      img.src = 'data:image/jpeg;base64,' + window.btoa(r.result); // doesn't work on IE11\n    }\n  };\n\n  return deferred.promise();\n};\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction arrayBufferToString(buffer) {\n  return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\n}\n\nfunction binaryToString(binary) {\n  var error = void 0;\n\n  try {\n    return decodeURIComponent(escape(binary));\n  } catch (_error) {\n    error = _error;\n    if (error instanceof URIError) {\n      return binary;\n    }\n    throw error;\n  }\n}\n\n/**\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\n *\n * @param {ImageFrame} imageFrame\n * @param {Uint8Array} pixelData\n * @param {HTMLCanvasElement} canvas\n */\n\n/***/ }),\n/* 15 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageId) {\n  var imagePixelModule = cornerstone.metaData.get('imagePixelModule', imageId);\n\n  return {\n    samplesPerPixel: imagePixelModule.samplesPerPixel,\n    photometricInterpretation: imagePixelModule.photometricInterpretation,\n    planarConfiguration: imagePixelModule.planarConfiguration,\n    rows: imagePixelModule.rows,\n    columns: imagePixelModule.columns,\n    bitsAllocated: imagePixelModule.bitsAllocated,\n    pixelRepresentation: imagePixelModule.pixelRepresentation, // 0 = unsigned,\n    smallestPixelValue: imagePixelModule.smallestPixelValue,\n    largestPixelValue: imagePixelModule.largestPixelValue,\n    redPaletteColorLookupTableDescriptor: imagePixelModule.redPaletteColorLookupTableDescriptor,\n    greenPaletteColorLookupTableDescriptor: imagePixelModule.greenPaletteColorLookupTableDescriptor,\n    bluePaletteColorLookupTableDescriptor: imagePixelModule.bluePaletteColorLookupTableDescriptor,\n    redPaletteColorLookupTableData: imagePixelModule.redPaletteColorLookupTableData,\n    greenPaletteColorLookupTableData: imagePixelModule.greenPaletteColorLookupTableData,\n    bluePaletteColorLookupTableData: imagePixelModule.bluePaletteColorLookupTableData,\n    pixelData: undefined // populated later after decoding\n  };\n};\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/***/ }),\n/* 16 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (storedPixelData) {\n  var min = storedPixelData[0];\n  var max = storedPixelData[0];\n  var numPixels = storedPixelData.length;\n\n  for (var index = 0; index < numPixels; index++) {\n    var storedPixel = storedPixelData[index];\n\n    min = Math.min(min, storedPixel);\n    max = Math.max(max, storedPixel);\n  }\n\n  return {\n    min: min,\n    max: max\n  };\n};\n\n/***/ }),\n/* 17 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (photometricInterpretation) {\n  return photometricInterpretation === 'RGB' || photometricInterpretation === 'PALETTE COLOR' || photometricInterpretation === 'YBR_FULL' || photometricInterpretation === 'YBR_FULL_422' || photometricInterpretation === 'YBR_PARTIAL_422' || photometricInterpretation === 'YBR_PARTIAL_420' || photometricInterpretation === 'YBR_RCT' || photometricInterpretation === 'YBR_ICT';\n};\n\n/***/ }),\n/* 18 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, transferSyntax) {\n  transferSyntax = transferSyntax || imageFrame.transferSyntax;\n\n  return imageFrame.bitsAllocated === 8 && transferSyntax === '1.2.840.10008.1.2.4.50' && (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4);\n};\n\n/***/ }),\n/* 19 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _options = __webpack_require__(8);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// the taskId to assign to the next task added via addTask()\nvar nextTaskId = 0;\n\n// array of queued tasks sorted with highest priority task first\nvar tasks = [];\n\n// array of web workers to dispatch decode tasks to\nvar webWorkers = [];\n\n// The options for CornerstoneWADOImageLoader\nvar options = (0, _options.getOptions)();\n\nvar defaultConfig = {\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\n  startWebWorkersOnDemand: true,\n  webWorkerPath: '../../dist/cornerstoneWADOImageLoaderWebWorker.js',\n  webWorkerTaskPaths: [],\n  taskConfiguration: {\n    decodeTask: {\n      loadCodecsOnStartup: true,\n      initializeCodecsOnStartup: false,\n      codecsPath: '../dist/cornerstoneWADOImageLoaderCodecs.js',\n      usePDFJS: false,\n      strict: options.strict\n    }\n  }\n};\n\nvar config = void 0;\n\nvar statistics = {\n  maxWebWorkers: 0,\n  numWebWorkers: 0,\n  numTasksQueued: 0,\n  numTasksExecuting: 0,\n  numTasksCompleted: 0,\n  totalTaskTimeInMS: 0,\n  totalTimeDelayedInMS: 0\n};\n\n/**\n * Function to start a task on a web worker\n */\nfunction startTaskOnWebWorker() {\n  // return immediately if no decode tasks to do\n  if (!tasks.length) {\n    return;\n  }\n\n  // look for a web worker that is ready\n  for (var i = 0; i < webWorkers.length; i++) {\n    if (webWorkers[i].status === 'ready') {\n      // mark it as busy so tasks are not assigned to it\n      webWorkers[i].status = 'busy';\n\n      // get the highest priority task\n      var task = tasks.shift();\n\n      task.start = new Date().getTime();\n\n      // update stats with how long this task was delayed (waiting in queue)\n      var end = new Date().getTime();\n\n      statistics.totalTimeDelayedInMS += end - task.added;\n\n      // assign this task to this web worker and send the web worker\n      // a message to execute it\n      webWorkers[i].task = task;\n      webWorkers[i].worker.postMessage({\n        taskType: task.taskType,\n        workerIndex: i,\n        data: task.data\n      }, task.transferList);\n      statistics.numTasksExecuting++;\n\n      return;\n    }\n  }\n\n  // if no available web workers and we haven't started max web workers, start a new one\n  if (webWorkers.length < config.maxWebWorkers) {\n    spawnWebWorker();\n  }\n}\n\n/**\n * Function to handle a message from a web worker\n * @param msg\n */\nfunction handleMessageFromWorker(msg) {\n  // console.log('handleMessageFromWorker', msg.data);\n  if (msg.data.taskType === 'initialize') {\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    startTaskOnWebWorker();\n  } else {\n    var start = webWorkers[msg.data.workerIndex].task.start;\n\n    webWorkers[msg.data.workerIndex].task.deferred.resolve(msg.data.result);\n    webWorkers[msg.data.workerIndex].task = undefined;\n\n    statistics.numTasksExecuting--;\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    statistics.numTasksCompleted++;\n\n    var end = new Date().getTime();\n\n    statistics.totalTaskTimeInMS += end - start;\n\n    startTaskOnWebWorker();\n  }\n}\n\n/**\n * Spawns a new web worker\n */\nfunction spawnWebWorker() {\n  // prevent exceeding maxWebWorkers\n  if (webWorkers.length >= config.maxWebWorkers) {\n    return;\n  }\n\n  // spawn the webworker\n  var worker = new Worker(config.webWorkerPath);\n\n  webWorkers.push({\n    worker: worker,\n    status: 'initializing'\n  });\n  worker.addEventListener('message', handleMessageFromWorker);\n  worker.postMessage({\n    taskType: 'initialize',\n    workerIndex: webWorkers.length - 1,\n    config: config\n  });\n}\n\n/**\n * Initialization function for the web worker manager - spawns web workers\n * @param configObject\n */\nfunction initialize(configObject) {\n  configObject = configObject || defaultConfig;\n\n  // prevent being initialized more than once\n  if (config) {\n    throw new Error('WebWorkerManager already initialized');\n  }\n\n  config = configObject;\n\n  config.maxWebWorkers = config.maxWebWorkers || navigator.hardwareConcurrency || 1;\n\n  // Spawn new web workers\n  if (!config.startWebWorkersOnDemand) {\n    for (var i = 0; i < config.maxWebWorkers; i++) {\n      spawnWebWorker();\n    }\n  }\n}\n\n/**\n * dynamically loads a web worker task\n * @param sourcePath\n * @param taskConfig\n */\nfunction loadWebWorkerTask(sourcePath, taskConfig) {\n  // add it to the list of web worker tasks paths so on demand web workers\n  // load this properly\n  config.webWorkerTaskPaths.push(sourcePath);\n\n  // if a task specific configuration is provided, merge it into the config\n  if (taskConfig) {\n    config.taskConfiguration = Object.assign(config.taskConfiguration, taskConfig);\n  }\n\n  // tell each spawned web worker to load this task\n  for (var i = 0; i < webWorkers.length; i++) {\n    webWorkers[i].worker.postMessage({\n      taskType: 'loadWebWorkerTask',\n      workerIndex: webWorkers.length - 1,\n      sourcePath: sourcePath,\n      config: config\n    });\n  }\n}\n\n/**\n * Function to add a decode task to be performed\n *\n * @param taskType - the taskType for this task\n * @param data - data specific to the task\n * @param priority - optional priority of the task (defaults to 0), > 0 is higher, < 0 is lower\n * @param transferList - optional array of data to transfer to web worker\n *\n * @returns {Object}\n */\nfunction addTask(taskType, data) {\n  var priority = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n  var transferList = arguments[3];\n\n  if (!config) {\n    initialize();\n  }\n\n  var deferred = _jquery2.default.Deferred();\n\n  // find the right spot to insert this decode task (based on priority)\n  var i = void 0;\n\n  for (i = 0; i < tasks.length; i++) {\n    if (tasks[i].priority <= priority) {\n      break;\n    }\n  }\n\n  var taskId = nextTaskId++;\n\n  // insert the decode task at position i\n  tasks.splice(i, 0, {\n    taskId: taskId,\n    taskType: taskType,\n    status: 'ready',\n    added: new Date().getTime(),\n    data: data,\n    deferred: deferred,\n    priority: priority,\n    transferList: transferList\n  });\n\n  // try to start a task on the web worker since we just added a new task and a web worker may be available\n  startTaskOnWebWorker();\n\n  return {\n    taskId: taskId,\n    promise: deferred.promise()\n  };\n}\n\n/**\n * Changes the priority of a queued task\n * @param taskId - the taskId to change the priority of\n * @param priority - priority of the task (defaults to 0), > 0 is higher, < 0 is lower\n * @returns boolean - true on success, false if taskId not found\n */\nfunction setTaskPriority(taskId) {\n  var priority = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n\n  // search for this taskId\n  for (var i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      var task = tasks.splice(i, 1)[0];\n\n      // set its priority\n      task.priority = priority;\n\n      // find the right spot to insert this decode task (based on priority)\n      for (i = 0; i < tasks.length; i++) {\n        if (tasks[i].priority <= priority) {\n          break;\n        }\n      }\n\n      // insert the decode task at position i\n      tasks.splice(i, 0, task);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Cancels a queued task and rejects\n * @param taskId - the taskId to cancel\n * @param reason - optional reason the task was rejected\n * @returns boolean - true on success, false if taskId not found\n */\nfunction cancelTask(taskId, reason) {\n  // search for this taskId\n  for (var i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      var task = tasks.splice(i, 1);\n\n      task.promise.reject(reason);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Function to return the statistics on running web workers\n * @returns object containing statistics\n */\nfunction getStatistics() {\n  statistics.maxWebWorkers = config.maxWebWorkers;\n  statistics.numWebWorkers = webWorkers.length;\n  statistics.numTasksQueued = tasks.length;\n\n  return statistics;\n}\n\nexports.default = {\n  initialize: initialize,\n  loadWebWorkerTask: loadWebWorkerTask,\n  addTask: addTask,\n  getStatistics: getStatistics,\n  setTaskPriority: setTaskPriority,\n  cancelTask: cancelTask\n};\n\n/***/ }),\n/* 20 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = findIndexOfString;\n\nvar _stringToUint8Array = __webpack_require__(51);\n\nvar _stringToUint8Array2 = _interopRequireDefault(_stringToUint8Array);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * checkToken\n *\n * @param token\n * @param data\n * @param dataOffset\n * @return {boolean}\n */\nfunction checkToken(token, data, dataOffset) {\n  if (dataOffset + token.length > data.length) {\n    return false;\n  }\n\n  var endIndex = dataOffset;\n\n  for (var i = 0; i < token.length; i++) {\n    if (token[i] !== data[endIndex++]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n *\n * @param data\n * @param str\n * @param offset\n * @return {*}\n */\nfunction findIndexOfString(data, str, offset) {\n\n  offset = offset || 0;\n\n  var token = (0, _stringToUint8Array2.default)(str);\n\n  for (var i = offset; i < data.length; i++) {\n    if (token[0] === data[i]) {\n      // console.log('match @', i);\n      if (checkToken(token, data, i)) {\n        return i;\n      }\n    }\n  }\n\n  return -1;\n}\n\n/***/ }),\n/* 21 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (uri, imageId, mediaType) {\n  mediaType = mediaType || 'application/octet-stream';\n  var headers = {\n    accept: mediaType\n  };\n\n  var deferred = _jquery2.default.Deferred();\n\n  var loadPromise = (0, _internal.xhrRequest)(uri, imageId, headers);\n\n  loadPromise.then(function (imageFrameAsArrayBuffer /* , xhr*/) {\n\n    // request succeeded, Parse the multi-part mime response\n    var response = new Uint8Array(imageFrameAsArrayBuffer);\n\n    // First look for the multipart mime header\n    var tokenIndex = (0, _findIndexOfString2.default)(response, '\\r\\n\\r\\n');\n\n    if (tokenIndex === -1) {\n      deferred.reject('invalid response - no multipart mime header');\n    }\n    var header = (0, _uint8ArrayToString2.default)(response, 0, tokenIndex);\n\n    // Now find the boundary marker\n    var split = header.split('\\r\\n');\n    var boundary = findBoundary(split);\n\n    if (!boundary) {\n      deferred.reject('invalid response - no boundary marker');\n    }\n    var offset = tokenIndex + 4; // skip over the \\r\\n\\r\\n\n\n    // find the terminal boundary marker\n    var endIndex = (0, _findIndexOfString2.default)(response, boundary, offset);\n\n    if (endIndex === -1) {\n      deferred.reject('invalid response - terminating boundary not found');\n    }\n\n    // Remove \\r\\n from the length\n    var length = endIndex - offset - 2;\n\n    // return the info for this pixel data\n    deferred.resolve({\n      contentType: findContentType(split),\n      imageFrame: {\n        pixelData: new Uint8Array(imageFrameAsArrayBuffer, offset, length)\n      }\n    });\n  });\n\n  return deferred.promise();\n};\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _internal = __webpack_require__(2);\n\nvar _findIndexOfString = __webpack_require__(20);\n\nvar _findIndexOfString2 = _interopRequireDefault(_findIndexOfString);\n\nvar _uint8ArrayToString = __webpack_require__(52);\n\nvar _uint8ArrayToString2 = _interopRequireDefault(_uint8ArrayToString);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n *\n * @param header\n * @return {*}\n */\nfunction findBoundary(header) {\n  for (var i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 2) === '--') {\n      return header[i];\n    }\n  }\n}\n\n/**\n *\n * @param header\n * @return {String|Undefined}\n */\nfunction findContentType(header) {\n  for (var i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 13) === 'Content-Type:') {\n      return header[i].substr(13).trim();\n    }\n  }\n}\n\n/**\n *\n * @param {String} uri\n * @param {String} imageId\n * @param {String} mediaType\n * @returns {Promise}\n */\n\n/***/ }),\n/* 22 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, index) {\n  var value = (0, _getValue2.default)(element, index);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n};\n\nvar _getValue = __webpack_require__(4);\n\nvar _getValue2 = _interopRequireDefault(_getValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 23 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, minimumLength) {\n  if (!element) {\n    return;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return;\n  }\n  // make sure we have the expected length\n  if (minimumLength && element.Value.length < minimumLength) {\n    return;\n  }\n\n  var values = [];\n\n  for (var i = 0; i < element.Value.length; i++) {\n    values.push(parseFloat(element.Value[i]));\n  }\n\n  return values;\n};\n\n/***/ }),\n/* 24 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar files = [];\n\n/**\n * Adds a file to the file manager\n *\n * @param file\n * @return {string} An imageId for the added file\n */\nfunction add(file) {\n  var fileIndex = files.push(file);\n\n  return \"dicomfile:\" + (fileIndex - 1);\n}\n\n/**\n * Retrieve the file at a specific index in the fileManager\n *\n * @param {Number} index\n * @return {*}\n */\nfunction get(index) {\n  return files[index];\n}\n\n/**\n * Remove the file at a specific index in the fileManager\n *\n * @param {Number} index\n */\nfunction remove(index) {\n  files[index] = undefined;\n}\n\n/**\n * Erase all files stored in the file manager\n */\nfunction purge() {\n  files = [];\n}\n\nexports.default = {\n  add: add,\n  get: get,\n  remove: remove,\n  purge: purge\n};\n\n/***/ }),\n/* 25 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = getEncapsulatedImageFrame;\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\n/**\n *\n * @param dataSet\n * @return {boolean} Whether or not the frames are fragmented\n */\nfunction framesAreFragmented(dataSet) {\n  var numberOfFrames = dataSet.intString('x00280008');\n  var pixelDataElement = dataSet.elements.x7fe00010;\n\n  return numberOfFrames !== pixelDataElement.fragments.length;\n}\n\n/**\n * Function to deal with extracting an image frame from an encapsulated data set.\n *\n * @param dataSet\n * @param frameIndex\n * @return {*}\n */\nfunction getEncapsulatedImageFrame(dataSet, frameIndex) {\n  if (dataSet.elements.x7fe00010.basicOffsetTable.length) {\n    // Basic Offset Table is not empty\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex);\n  }\n\n  // Empty basic offset table\n  if (framesAreFragmented(dataSet)) {\n    var basicOffsetTable = dicomParser.createJPEGBasicOffsetTable(dataSet, dataSet.elements.x7fe00010);\n\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex, basicOffsetTable);\n  }\n\n  return dicomParser.readEncapsulatedPixelDataFromFragments(dataSet, dataSet.elements.x7fe00010, frameIndex);\n}\n\n/***/ }),\n/* 26 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (dataSet, frameIndex) {\n  var pixelDataElement = dataSet.elements.x7fe00010;\n  var bitsAllocated = dataSet.uint16('x00280100');\n  var rows = dataSet.uint16('x00280010');\n  var columns = dataSet.uint16('x00280011');\n  var samplesPerPixel = dataSet.uint16('x00280002');\n\n  var pixelDataOffset = pixelDataElement.dataOffset;\n  var pixelsPerFrame = rows * columns * samplesPerPixel;\n\n  var frameOffset = void 0;\n\n  if (bitsAllocated === 8) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame);\n  } else if (bitsAllocated === 16) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 2;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 2);\n  } else if (bitsAllocated === 1) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 0.125;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return (0, _unpackBinaryFrame2.default)(dataSet.byteArray, frameOffset, pixelsPerFrame);\n  }\n\n  throw new Error('unsupported pixel format');\n};\n\nvar _unpackBinaryFrame = __webpack_require__(32);\n\nvar _unpackBinaryFrame2 = _interopRequireDefault(_unpackBinaryFrame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 27 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (uri) {\n  var parsedImageId = (0, _parseImageId2.default)(uri);\n  var fileIndex = parseInt(parsedImageId.url, 10);\n  var file = _fileManager2.default.get(fileIndex);\n  var deferred = _jquery2.default.Deferred();\n  var fileReader = new FileReader();\n\n  fileReader.onload = function (e) {\n    var dicomPart10AsArrayBuffer = e.target.result;\n\n    deferred.resolve(dicomPart10AsArrayBuffer);\n  };\n\n  fileReader.readAsArrayBuffer(file);\n\n  return deferred.promise();\n};\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _fileManager = __webpack_require__(24);\n\nvar _fileManager2 = _interopRequireDefault(_fileManager);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 28 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\nfunction getLutDescriptor(dataSet, tag) {\n  if (!dataSet.elements[tag] || dataSet.elements[tag].length !== 6) {\n    return;\n  }\n\n  return [dataSet.uint16(tag, 0), dataSet.uint16(tag, 1), dataSet.uint16(tag, 2)];\n}\n\nfunction getLutData(lutDataSet, tag, lutDescriptor) {\n  var lut = [];\n  var lutData = lutDataSet.elements[tag];\n  var numLutEntries = lutDescriptor[0];\n\n  for (var i = 0; i < numLutEntries; i++) {\n    // Output range is always unsigned\n    if (lutDescriptor[2] === 16) {\n      lut[i] = lutDataSet.uint16(tag, i);\n    } else {\n      lut[i] = lutDataSet.byteArray[i + lutData.dataOffset];\n    }\n  }\n\n  return lut;\n}\n\nfunction populatePaletteColorLut(dataSet, imagePixelModule) {\n  // return immediately if photometric interpretation is not PALETTE COLOR or no palette lut elements\n  if (imagePixelModule.photometricInterpretation !== 'PALETTE COLOR' || !dataSet.elements.x00281101) {\n    return;\n  }\n  imagePixelModule.redPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281101');\n  imagePixelModule.greenPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281102');\n  imagePixelModule.bluePaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281103');\n\n  imagePixelModule.redPaletteColorLookupTableData = getLutData(dataSet, 'x00281201', imagePixelModule.redPaletteColorLookupTableDescriptor);\n  imagePixelModule.greenPaletteColorLookupTableData = getLutData(dataSet, 'x00281202', imagePixelModule.greenPaletteColorLookupTableDescriptor);\n  imagePixelModule.bluePaletteColorLookupTableData = getLutData(dataSet, 'x00281203', imagePixelModule.bluePaletteColorLookupTableDescriptor);\n}\n\nfunction populateSmallestLargestPixelValues(dataSet, imagePixelModule) {\n  var pixelRepresentation = dataSet.uint16('x00280103');\n\n  if (pixelRepresentation === 0) {\n    imagePixelModule.smallestPixelValue = dataSet.uint16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.uint16('x00280107');\n  } else {\n    imagePixelModule.smallestPixelValue = dataSet.int16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.int16('x00280107');\n  }\n}\n\nfunction getImagePixelModule(dataSet) {\n\n  var imagePixelModule = {\n    samplesPerPixel: dataSet.uint16('x00280002'),\n    photometricInterpretation: dataSet.string('x00280004'),\n    rows: dataSet.uint16('x00280010'),\n    columns: dataSet.uint16('x00280011'),\n    bitsAllocated: dataSet.uint16('x00280100'),\n    bitsStored: dataSet.uint16('x00280101'),\n    highBit: dataSet.uint16('x00280102'),\n    pixelRepresentation: dataSet.uint16('x00280103'),\n    planarConfiguration: dataSet.uint16('x00280006'),\n    pixelAspectRatio: dataSet.string('x00280034')\n  };\n\n  populateSmallestLargestPixelValues(dataSet, imagePixelModule);\n  populatePaletteColorLut(dataSet, imagePixelModule);\n\n  return imagePixelModule;\n}\n\nexports.default = getImagePixelModule;\n\n/***/ }),\n/* 29 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n\nfunction getLUT(pixelRepresentation, lutDataSet) {\n  var numLUTEntries = lutDataSet.uint16('x00283002', 0);\n\n  if (numLUTEntries === 0) {\n    numLUTEntries = 65535;\n  }\n  var firstValueMapped = 0;\n\n  if (pixelRepresentation === 0) {\n    firstValueMapped = lutDataSet.uint16('x00283002', 1);\n  } else {\n    firstValueMapped = lutDataSet.int16('x00283002', 1);\n  }\n  var numBitsPerEntry = lutDataSet.uint16('x00283002', 2);\n  // console.log('LUT(', numLUTEntries, ',', firstValueMapped, ',', numBitsPerEntry, ')');\n  var lut = {\n    id: '1',\n    firstValueMapped: firstValueMapped,\n    numBitsPerEntry: numBitsPerEntry,\n    lut: []\n  };\n\n  // console.log(\"minValue=\", minValue, \"; maxValue=\", maxValue);\n  for (var i = 0; i < numLUTEntries; i++) {\n    if (pixelRepresentation === 0) {\n      lut.lut[i] = lutDataSet.uint16('x00283006', i);\n    } else {\n      lut.lut[i] = lutDataSet.int16('x00283006', i);\n    }\n  }\n\n  return lut;\n}\n\nfunction getLUTs(pixelRepresentation, lutSequence) {\n  if (!lutSequence || !lutSequence.items.length) {\n    return;\n  }\n  var luts = [];\n\n  for (var i = 0; i < lutSequence.items.length; i++) {\n    var lutDataSet = lutSequence.items[i].dataSet;\n    var lut = getLUT(pixelRepresentation, lutDataSet);\n\n    if (lut) {\n      luts.push(lut);\n    }\n  }\n\n  return luts;\n}\n\nexports.default = getLUTs;\n\n/***/ }),\n/* 30 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/* eslint no-bitwise: 0 */\n\nfunction getMinStoredPixelValue(dataSet) {\n  var pixelRepresentation = dataSet.uint16('x00280103');\n  var bitsStored = dataSet.uint16('x00280101');\n\n  if (pixelRepresentation === 0) {\n    return 0;\n  }\n\n  return -1 << bitsStored - 1;\n}\n\n// 0 = unsigned / US, 1 = signed / SS\nfunction getModalityLUTOutputPixelRepresentation(dataSet) {\n\n  // CT SOP Classes are always signed\n  var sopClassUID = dataSet.string('x00080016');\n\n  if (sopClassUID === '1.2.840.10008.5.1.4.1.1.2' || sopClassUID === '1.2.840.10008.5.1.4.1.1.2.1') {\n    return 1;\n  }\n\n  // if rescale intercept and rescale slope are present, pass the minimum stored\n  // pixel value through them to see if we get a signed output range\n  var rescaleIntercept = dataSet.floatString('x00281052');\n  var rescaleSlope = dataSet.floatString('x00281053');\n\n  if (rescaleIntercept !== undefined && rescaleSlope !== undefined) {\n    var minStoredPixelValue = getMinStoredPixelValue(dataSet); //\n    var minModalityLutValue = minStoredPixelValue * rescaleSlope + rescaleIntercept;\n\n    if (minModalityLutValue < 0) {\n      return 1;\n    }\n\n    return 0;\n  }\n\n  // Output of non linear modality lut is always unsigned\n  if (dataSet.elements.x00283000 && dataSet.elements.x00283000.length > 0) {\n    return 0;\n  }\n\n  // If no modality lut transform, output is same as pixel representation\n  return dataSet.uint16('x00280103');\n}\n\nexports.default = getModalityLUTOutputPixelRepresentation;\n\n/***/ }),\n/* 31 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nfunction getNumberValues(dataSet, tag, minimumLength) {\n  var values = [];\n  var valueAsString = dataSet.string(tag);\n\n  if (!valueAsString) {\n    return;\n  }\n  var split = valueAsString.split('\\\\');\n\n  if (minimumLength && split.length < minimumLength) {\n    return;\n  }\n  for (var i = 0; i < split.length; i++) {\n    values.push(parseFloat(split[i]));\n  }\n\n  return values;\n}\n\nexports.default = getNumberValues;\n\n/***/ }),\n/* 32 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (byteArray, frameOffset, pixelsPerFrame) {\n  // Create a new pixel array given the image size\n  var pixelData = new Uint8Array(pixelsPerFrame);\n\n  for (var i = 0; i < pixelsPerFrame; i++) {\n    // Compute byte position\n    var bytePos = Math.floor(i / 8);\n\n    // Get the current byte\n    var byte = byteArray[bytePos + frameOffset];\n\n    // Bit position (0-7) within byte\n    var bitPos = i % 8;\n\n    // Check whether bit at bitpos is set\n    pixelData[i] = isBitSet(byte, bitPos) ? 1 : 0;\n  }\n\n  return pixelData;\n};\n\n/* eslint no-bitwise: 0 */\n\n/**\n * Check whether a bit position is set inside a byte\n *\n * @param {Number} byte The input byte\n * @param {Number} bitPos The bit position\n * @return {Boolean} Whether or not the bit is set\n */\nfunction isBitSet(byte, bitPos) {\n  return Boolean(byte & 1 << bitPos);\n}\n\n/**\n * Function to deal with unpacking a binary frame\n *\n * @param byteArray\n * @param {Number} frameOffset\n * @param pixelsPerFrame\n *\n * @return {Uint8Array}\n */\n\n/***/ }),\n/* 33 */,\n/* 34 */,\n/* 35 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (options) {\n  (0, _internal.setOptions)(options);\n};\n\nvar _internal = __webpack_require__(2);\n\n/***/ }),\n/* 36 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _metaData = __webpack_require__(49);\n\nvar _findIndexOfString = __webpack_require__(20);\n\nvar _findIndexOfString2 = _interopRequireDefault(_findIndexOfString);\n\nvar _getPixelData = __webpack_require__(21);\n\nvar _getPixelData2 = _interopRequireDefault(_getPixelData);\n\nvar _metaDataManager = __webpack_require__(9);\n\nvar _metaDataManager2 = _interopRequireDefault(_metaDataManager);\n\nvar _loadImage = __webpack_require__(47);\n\nvar _loadImage2 = _interopRequireDefault(_loadImage);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar metaData = {\n  getNumberString: _metaData.getNumberString,\n  getNumberValue: _metaData.getNumberValue,\n  getNumberValues: _metaData.getNumberValues,\n  getValue: _metaData.getValue,\n  metaDataProvider: _metaData.metaDataProvider\n};\n\nexports.default = {\n  metaData: metaData,\n  findIndexOfString: _findIndexOfString2.default,\n  getPixelData: _getPixelData2.default,\n  loadImage: _loadImage2.default,\n  metaDataManager: _metaDataManager2.default\n};\n\n/***/ }),\n/* 37 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _metaData = __webpack_require__(54);\n\nvar _dataSetCacheManager = __webpack_require__(10);\n\nvar _dataSetCacheManager2 = _interopRequireDefault(_dataSetCacheManager);\n\nvar _fileManager = __webpack_require__(24);\n\nvar _fileManager2 = _interopRequireDefault(_fileManager);\n\nvar _getEncapsulatedImageFrame = __webpack_require__(25);\n\nvar _getEncapsulatedImageFrame2 = _interopRequireDefault(_getEncapsulatedImageFrame);\n\nvar _getUncompressedImageFrame = __webpack_require__(26);\n\nvar _getUncompressedImageFrame2 = _interopRequireDefault(_getUncompressedImageFrame);\n\nvar _loadFileRequest = __webpack_require__(27);\n\nvar _loadFileRequest2 = _interopRequireDefault(_loadFileRequest);\n\nvar _loadImage = __webpack_require__(53);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _unpackBinaryFrame = __webpack_require__(32);\n\nvar _unpackBinaryFrame2 = _interopRequireDefault(_unpackBinaryFrame);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar metaData = {\n  getImagePixelModule: _metaData.getImagePixelModule,\n  getLUTs: _metaData.getLUTs,\n  getModalityLUTOutputPixelRepresentation: _metaData.getModalityLUTOutputPixelRepresentation,\n  getNumberValues: _metaData.getNumberValues,\n  metaDataProvider: _metaData.metaDataProvider\n};\n\nexports.default = {\n  metaData: metaData,\n  dataSetCacheManager: _dataSetCacheManager2.default,\n  fileManager: _fileManager2.default,\n  getEncapsulatedImageFrame: _getEncapsulatedImageFrame2.default,\n  getUncompressedImageFrame: _getUncompressedImageFrame2.default,\n  loadFileRequest: _loadFileRequest2.default,\n  loadImageFromPromise: _loadImage.loadImageFromPromise,\n  getLoaderForScheme: _loadImage.getLoaderForScheme,\n  loadImage: _loadImage.loadImage,\n  parseImageId: _parseImageId2.default,\n  unpackBinaryFrame: _unpackBinaryFrame2.default\n};\n\n/***/ }),\n/* 38 */,\n/* 39 */,\n/* 40 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  var numPixels = imageFrame.columns * imageFrame.rows;\n  var palIndex = 0;\n  var rgbaIndex = 0;\n  var pixelData = imageFrame.pixelData;\n  var start = imageFrame.redPaletteColorLookupTableDescriptor[1];\n  var rData = imageFrame.redPaletteColorLookupTableData;\n  var gData = imageFrame.greenPaletteColorLookupTableData;\n  var bData = imageFrame.bluePaletteColorLookupTableData;\n  var shift = imageFrame.redPaletteColorLookupTableDescriptor[2] === 8 ? 0 : 8;\n  var len = imageFrame.redPaletteColorLookupTableData.length;\n\n  if (len === 0) {\n    len = 65535;\n  }\n\n  for (var i = 0; i < numPixels; ++i) {\n    var value = pixelData[palIndex++];\n\n    if (value < start) {\n      value = 0;\n    } else if (value > start + len - 1) {\n      value = len - 1;\n    } else {\n      value -= start;\n    }\n\n    rgbaBuffer[rgbaIndex++] = rData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = gData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = bData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = 255;\n  }\n};\n\n/***/ }),\n/* 41 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var rgbIndex = 0;\n  var rgbaIndex = 0;\n\n  for (var i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 42 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var rgbaIndex = 0;\n  var rIndex = 0;\n  var gIndex = numPixels;\n  var bIndex = numPixels * 2;\n\n  for (var i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 43 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var ybrIndex = 0;\n  var rgbaIndex = 0;\n\n  for (var i = 0; i < numPixels; i++) {\n    var y = imageFrame[ybrIndex++];\n    var cb = imageFrame[ybrIndex++];\n    var cr = imageFrame[ybrIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128); // red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 44 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  var numPixels = imageFrame.length / 3;\n  var rgbaIndex = 0;\n  var yIndex = 0;\n  var cbIndex = numPixels;\n  var crIndex = numPixels * 2;\n\n  for (var i = 0; i < numPixels; i++) {\n    var y = imageFrame[yIndex++];\n    var cb = imageFrame[cbIndex++];\n    var cr = imageFrame[crIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128); // red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n};\n\n/***/ }),\n/* 45 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _colorSpaceConverters = __webpack_require__(11);\n\nObject.keys(_colorSpaceConverters).forEach(function (key) {\n  if (key === \"default\" || key === \"__esModule\") return;\n  Object.defineProperty(exports, key, {\n    enumerable: true,\n    get: function get() {\n      return _colorSpaceConverters[key];\n    }\n  });\n});\n\nvar _wadouri = __webpack_require__(37);\n\nObject.defineProperty(exports, 'wadouri', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_wadouri).default;\n  }\n});\n\nvar _wadors = __webpack_require__(36);\n\nObject.defineProperty(exports, 'wadors', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_wadors).default;\n  }\n});\n\nvar _configure = __webpack_require__(35);\n\nObject.defineProperty(exports, 'configure', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_configure).default;\n  }\n});\n\nvar _convertColorSpace = __webpack_require__(12);\n\nObject.defineProperty(exports, 'convertColorSpace', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_convertColorSpace).default;\n  }\n});\n\nvar _createImage = __webpack_require__(7);\n\nObject.defineProperty(exports, 'createImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_createImage).default;\n  }\n});\n\nvar _decodeImageFrame = __webpack_require__(13);\n\nObject.defineProperty(exports, 'decodeImageFrame', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_decodeImageFrame).default;\n  }\n});\n\nvar _decodeJPEGBaseline8BitColor = __webpack_require__(14);\n\nObject.defineProperty(exports, 'decodeJPEGBaseline8BitColor', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_decodeJPEGBaseline8BitColor).default;\n  }\n});\n\nvar _getImageFrame = __webpack_require__(15);\n\nObject.defineProperty(exports, 'getImageFrame', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getImageFrame).default;\n  }\n});\n\nvar _getMinMax = __webpack_require__(16);\n\nObject.defineProperty(exports, 'getMinMax', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getMinMax).default;\n  }\n});\n\nvar _isColorImage = __webpack_require__(17);\n\nObject.defineProperty(exports, 'isColorImage', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_isColorImage).default;\n  }\n});\n\nvar _isJPEGBaseline8BitColor = __webpack_require__(18);\n\nObject.defineProperty(exports, 'isJPEGBaseline8BitColor', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_isJPEGBaseline8BitColor).default;\n  }\n});\n\nvar _webWorkerManager = __webpack_require__(19);\n\nObject.defineProperty(exports, 'webWorkerManager', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_webWorkerManager).default;\n  }\n});\n\nvar _version = __webpack_require__(3);\n\nObject.defineProperty(exports, 'version', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_version).default;\n  }\n});\n\nvar _internal = __webpack_require__(2);\n\nObject.defineProperty(exports, 'internal', {\n  enumerable: true,\n  get: function get() {\n    return _internal.internal;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 46 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _options = __webpack_require__(8);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction xhrRequest(url, imageId) {\n  var headers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n  var deferred = _jquery2.default.Deferred();\n  var options = (0, _options.getOptions)();\n\n  // Make the request for the DICOM P10 SOP Instance\n  var xhr = new XMLHttpRequest();\n\n  xhr.open('get', url, true);\n  xhr.responseType = 'arraybuffer';\n  options.beforeSend(xhr);\n  Object.keys(headers).forEach(function (key) {\n    xhr.setRequestHeader(key, headers[key]);\n  });\n\n  // handle response data\n  xhr.onreadystatechange = function () {\n    // TODO: consider sending out progress messages here as we receive the pixel data\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        deferred.resolve(xhr.response, xhr);\n      } else {\n        // request failed, reject the deferred\n        deferred.reject(xhr);\n      }\n    }\n  };\n  xhr.onprogress = function (oProgress) {\n    // console.log('progress:',oProgress)\n\n    if (oProgress.lengthComputable) {\n      // evt.loaded the bytes browser receive\n      // evt.total the total bytes seted by the header\n      //\n      var loaded = oProgress.loaded;\n      var total = oProgress.total;\n      var percentComplete = Math.round(loaded / total * 100);\n\n      (0, _jquery2.default)(cornerstone.events).trigger('CornerstoneImageLoadProgress', {\n        imageId: imageId,\n        loaded: loaded,\n        total: total,\n        percentComplete: percentComplete\n      });\n    }\n  };\n\n  xhr.send();\n\n  return deferred.promise();\n}\n\nexports.default = xhrRequest;\n\n/***/ }),\n/* 47 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = loadImage;\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nvar _metaDataManager = __webpack_require__(9);\n\nvar _metaDataManager2 = _interopRequireDefault(_metaDataManager);\n\nvar _getPixelData = __webpack_require__(21);\n\nvar _getPixelData2 = _interopRequireDefault(_getPixelData);\n\nvar _createImage = __webpack_require__(7);\n\nvar _createImage2 = _interopRequireDefault(_createImage);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getTransferSyntaxForContentType() /* contentType */{\n  return '1.2.840.10008.1.2'; // hard code to ILE for now\n}\n\n/**\n *\n * @param {string} imageId\n * @param {Object} options\n * @returns {Deferred}\n */\nfunction loadImage(imageId, options) {\n  var start = new Date().getTime();\n\n  var deferred = _jquery2.default.Deferred();\n\n  var uri = imageId.substring(7);\n\n  // check to make sure we have metadata for this imageId\n  var metaData = _metaDataManager2.default.get(imageId);\n\n  if (metaData === undefined) {\n    deferred.reject('no metadata for imageId ' + imageId);\n\n    return deferred.promise();\n  }\n\n  // TODO: load bulk data items that we might need\n\n  var mediaType = 'multipart/related; type=\"application/octet-stream\"'; // 'image/dicom+jp2';\n\n  // get the pixel data from the server\n  (0, _getPixelData2.default)(uri, imageId, mediaType).then(function (result) {\n\n    var transferSyntax = getTransferSyntaxForContentType(result.contentType);\n    var pixelData = result.imageFrame.pixelData;\n    var imagePromise = (0, _createImage2.default)(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      // add the loadTimeInMS property\n      var end = new Date().getTime();\n\n      image.loadTimeInMS = end - start;\n      deferred.resolve(image);\n    });\n  }).fail(function (reason) {\n    deferred.reject(reason);\n  });\n\n  return deferred;\n}\n\n// register wadors scheme\ncornerstone.registerImageLoader('wadors', loadImage);\n\n/***/ }),\n/* 48 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (element, index, defaultValue) {\n  var value = (0, _getValue2.default)(element, index, defaultValue);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n};\n\nvar _getValue = __webpack_require__(4);\n\nvar _getValue2 = _interopRequireDefault(_getValue);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 49 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getNumberString = __webpack_require__(48);\n\nObject.defineProperty(exports, 'getNumberString', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberString).default;\n  }\n});\n\nvar _getNumberValue = __webpack_require__(22);\n\nObject.defineProperty(exports, 'getNumberValue', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberValue).default;\n  }\n});\n\nvar _getNumberValues = __webpack_require__(23);\n\nObject.defineProperty(exports, 'getNumberValues', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberValues).default;\n  }\n});\n\nvar _getValue = __webpack_require__(4);\n\nObject.defineProperty(exports, 'getValue', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getValue).default;\n  }\n});\n\nvar _metaDataProvider = __webpack_require__(50);\n\nObject.defineProperty(exports, 'metaDataProvider', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_metaDataProvider).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 50 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getNumberValues = __webpack_require__(23);\n\nvar _getNumberValues2 = _interopRequireDefault(_getNumberValues);\n\nvar _getValue = __webpack_require__(4);\n\nvar _getValue2 = _interopRequireDefault(_getValue);\n\nvar _getNumberValue = __webpack_require__(22);\n\nvar _getNumberValue2 = _interopRequireDefault(_getNumberValue);\n\nvar _metaDataManager = __webpack_require__(9);\n\nvar _metaDataManager2 = _interopRequireDefault(_metaDataManager);\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction metaDataProvider(type, imageId) {\n  var metaData = _metaDataManager2.default.get(imageId);\n\n  if (!metaData) {\n    return;\n  }\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: (0, _getValue2.default)(metaData['00080060']),\n      seriesInstanceUID: (0, _getValue2.default)(metaData['0020000e']),\n      seriesNumber: (0, _getNumberValue2.default)(metaData['00200011']),\n      studyInstanceUID: (0, _getValue2.default)(metaData['0020000d']),\n      seriesDate: dicomParser.parseDA((0, _getValue2.default)(metaData['00080021'])),\n      seriesTime: dicomParser.parseTM((0, _getValue2.default)(metaData['00080031'], 0, ''))\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: (0, _getNumberValue2.default)(metaData['00101010']),\n      patientSize: (0, _getNumberValue2.default)(metaData['00101020']),\n      patientWeight: (0, _getNumberValue2.default)(metaData['00101030'])\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: (0, _getNumberValues2.default)(metaData['00280030'], 2),\n      imageOrientationPatient: (0, _getNumberValues2.default)(metaData['00200037'], 6),\n      imagePositionPatient: (0, _getNumberValues2.default)(metaData['00200032'], 3),\n      sliceThickness: (0, _getNumberValue2.default)(metaData['00180050']),\n      sliceLocation: (0, _getNumberValue2.default)(metaData['00201041'])\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return {\n      samplesPerPixel: (0, _getNumberValue2.default)(metaData['00280002']),\n      photometricInterpretation: (0, _getValue2.default)(metaData['00280004']),\n      rows: (0, _getNumberValue2.default)(metaData['00280010']),\n      columns: (0, _getNumberValue2.default)(metaData['00280011']),\n      bitsAllocated: (0, _getNumberValue2.default)(metaData['00280100']),\n      bitsStored: (0, _getNumberValue2.default)(metaData['00280101']),\n      highBit: (0, _getValue2.default)(metaData['00280102']),\n      pixelRepresentation: (0, _getNumberValue2.default)(metaData['00280103']),\n      planarConfiguration: (0, _getNumberValue2.default)(metaData['00280006']),\n      pixelAspectRatio: (0, _getValue2.default)(metaData['00280034']),\n      smallestPixelValue: (0, _getNumberValue2.default)(metaData['00280106']),\n      largestPixelValue: (0, _getNumberValue2.default)(metaData['00280107']),\n      redPaletteColorLookupTableDescriptor: (0, _getNumberValues2.default)(metaData['00281101']),\n      greenPaletteColorLookupTableDescriptor: (0, _getNumberValues2.default)(metaData['00281102']),\n      bluePaletteColorLookupTableDescriptor: (0, _getNumberValues2.default)(metaData['00281103']),\n      redPaletteColorLookupTableData: (0, _getNumberValues2.default)(metaData['00281201']),\n      greenPaletteColorLookupTableData: (0, _getNumberValues2.default)(metaData['00281202']),\n      bluePaletteColorLookupTableData: (0, _getNumberValues2.default)(metaData['00281203'])\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    return {\n      // TODO: VOI LUT Sequence\n      windowCenter: (0, _getNumberValues2.default)(metaData['00281050'], 1),\n      windowWidth: (0, _getNumberValues2.default)(metaData['00281051'], 1)\n    };\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      rescaleIntercept: (0, _getNumberValue2.default)(metaData['00281052']),\n      rescaleSlope: (0, _getNumberValue2.default)(metaData['00281053']),\n      rescaleType: (0, _getValue2.default)(metaData['00281054'])\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: (0, _getValue2.default)(metaData['00080016']),\n      sopInstanceUID: (0, _getValue2.default)(metaData['00080018'])\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    var radiopharmaceuticalInfo = (0, _getValue2.default)(metaData['00540016']);\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM((0, _getValue2.default)(radiopharmaceuticalInfo['00181072'], 0, '')),\n        radionuclideTotalDose: (0, _getNumberValue2.default)(radiopharmaceuticalInfo['00181074']),\n        radionuclideHalfLife: (0, _getNumberValue2.default)(radiopharmaceuticalInfo['00181075'])\n      }\n    };\n  }\n}\n\ncornerstone.metaData.addProvider(metaDataProvider);\n\nexports.default = metaDataProvider;\n\n/***/ }),\n/* 51 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (str) {\n  var uint = new Uint8Array(str.length);\n\n  for (var i = 0, j = str.length; i < j; i++) {\n    uint[i] = str.charCodeAt(i);\n  }\n\n  return uint;\n};\n\n/***/ }),\n/* 52 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.default = function (data, offset, length) {\n  offset = offset || 0;\n  length = length || data.length - offset;\n  var str = '';\n\n  for (var i = offset; i < offset + length; i++) {\n    str += String.fromCharCode(data[i]);\n  }\n\n  return str;\n};\n\n/***/ }),\n/* 53 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getLoaderForScheme = exports.loadImageFromPromise = undefined;\n\nvar _jquery = __webpack_require__(0);\n\nvar _jquery2 = _interopRequireDefault(_jquery);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nvar _createImage = __webpack_require__(7);\n\nvar _createImage2 = _interopRequireDefault(_createImage);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _dataSetCacheManager = __webpack_require__(10);\n\nvar _dataSetCacheManager2 = _interopRequireDefault(_dataSetCacheManager);\n\nvar _getEncapsulatedImageFrame = __webpack_require__(25);\n\nvar _getEncapsulatedImageFrame2 = _interopRequireDefault(_getEncapsulatedImageFrame);\n\nvar _getUncompressedImageFrame = __webpack_require__(26);\n\nvar _getUncompressedImageFrame2 = _interopRequireDefault(_getUncompressedImageFrame);\n\nvar _loadFileRequest = __webpack_require__(27);\n\nvar _loadFileRequest2 = _interopRequireDefault(_loadFileRequest);\n\nvar _internal = __webpack_require__(2);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/**\n * Add a decache callback function to clear out our dataSetCacheManager\n *\n * @param {Image} image\n */\nfunction addDecache(image) {\n  image.decache = function () {\n    // console.log('decache');\n    var parsedImageId = (0, _parseImageId2.default)(image.imageId);\n\n    _dataSetCacheManager2.default.unload(parsedImageId.url);\n  };\n}\n\n/**\n *\n * @param {DataSet} dataSet\n * @param {Number} frameIndex\n * @return {*}\n */\nfunction getPixelData(dataSet, frameIndex) {\n  var pixelDataElement = dataSet.elements.x7fe00010;\n\n  if (pixelDataElement.encapsulatedPixelData) {\n    return (0, _getEncapsulatedImageFrame2.default)(dataSet, frameIndex);\n  }\n\n  return (0, _getUncompressedImageFrame2.default)(dataSet, frameIndex);\n}\n\n/**\n *\n * @param dataSetPromise\n * @param imageId\n * @param frame\n * @param options\n * @return {*}\n */\nfunction loadImageFromPromise(dataSetPromise, imageId, frame, options) {\n\n  var start = new Date().getTime();\n\n  frame = frame || 0;\n  var deferred = _jquery2.default.Deferred();\n\n  dataSetPromise.then(function (dataSet /* , xhr*/) {\n    var pixelData = getPixelData(dataSet, frame);\n    var transferSyntax = dataSet.string('x00020010');\n    var loadEnd = new Date().getTime();\n    var imagePromise = (0, _createImage2.default)(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      image.data = dataSet;\n      var end = new Date().getTime();\n\n      image.loadTimeInMS = loadEnd - start;\n      image.totalTimeInMS = end - start;\n      addDecache(image);\n      deferred.resolve(image);\n    });\n  }, function (error) {\n    deferred.reject(error);\n  });\n\n  return deferred;\n}\n\n/**\n *\n * @param {String} scheme\n * @return {*}\n */\nfunction getLoaderForScheme(scheme) {\n  if (scheme === 'dicomweb' || scheme === 'wadouri') {\n    return _internal.xhrRequest;\n  } else if (scheme === 'dicomfile') {\n    return _loadFileRequest2.default;\n  }\n}\n\n/**\n * Load an imageId\n *\n * @param {String} imageId\n * @param {Object} options\n * @return {*}\n */\nfunction loadImage(imageId, options) {\n  var parsedImageId = (0, _parseImageId2.default)(imageId);\n  var url = parsedImageId.url;\n  var dataSet = void 0;\n\n  // if the dataset for this url is already loaded, use it\n  if (_dataSetCacheManager2.default.isLoaded(url)) {\n    dataSet = _dataSetCacheManager2.default.get(url);\n\n    return loadImageFromPromise(dataSet, imageId, parsedImageId.frame, options);\n  }\n\n  // load the dataSet via the dataSetCacheManager\n  var loader = getLoaderForScheme(parsedImageId.scheme);\n\n  dataSet = _dataSetCacheManager2.default.load(url, loader, imageId);\n\n  return loadImageFromPromise(dataSet, imageId, parsedImageId.frame, options);\n}\n\n// register dicomweb and wadouri image loader prefixes\ncornerstone.registerImageLoader('dicomweb', loadImage);\ncornerstone.registerImageLoader('wadouri', loadImage);\ncornerstone.registerImageLoader('dicomfile', loadImage);\n\nexports.loadImageFromPromise = loadImageFromPromise;\nexports.getLoaderForScheme = getLoaderForScheme;\nexports.default = loadImage;\n\n/***/ }),\n/* 54 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getImagePixelModule = __webpack_require__(28);\n\nObject.defineProperty(exports, 'getImagePixelModule', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getImagePixelModule).default;\n  }\n});\n\nvar _getLUTs = __webpack_require__(29);\n\nObject.defineProperty(exports, 'getLUTs', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getLUTs).default;\n  }\n});\n\nvar _getModalityLUTOutputPixelRepresentation = __webpack_require__(30);\n\nObject.defineProperty(exports, 'getModalityLUTOutputPixelRepresentation', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getModalityLUTOutputPixelRepresentation).default;\n  }\n});\n\nvar _getNumberValues = __webpack_require__(31);\n\nObject.defineProperty(exports, 'getNumberValues', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_getNumberValues).default;\n  }\n});\n\nvar _metaDataProvider = __webpack_require__(55);\n\nObject.defineProperty(exports, 'metaDataProvider', {\n  enumerable: true,\n  get: function get() {\n    return _interopRequireDefault(_metaDataProvider).default;\n  }\n});\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n/***/ }),\n/* 55 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _getNumberValues = __webpack_require__(31);\n\nvar _getNumberValues2 = _interopRequireDefault(_getNumberValues);\n\nvar _parseImageId = __webpack_require__(5);\n\nvar _parseImageId2 = _interopRequireDefault(_parseImageId);\n\nvar _dataSetCacheManager = __webpack_require__(10);\n\nvar _dataSetCacheManager2 = _interopRequireDefault(_dataSetCacheManager);\n\nvar _getImagePixelModule = __webpack_require__(28);\n\nvar _getImagePixelModule2 = _interopRequireDefault(_getImagePixelModule);\n\nvar _getLUTs = __webpack_require__(29);\n\nvar _getLUTs2 = _interopRequireDefault(_getLUTs);\n\nvar _getModalityLUTOutputPixelRepresentation = __webpack_require__(30);\n\nvar _getModalityLUTOutputPixelRepresentation2 = _interopRequireDefault(_getModalityLUTOutputPixelRepresentation);\n\nvar _dicomParser = __webpack_require__(6);\n\nvar dicomParser = _interopRequireWildcard(_dicomParser);\n\nvar _cornerstoneCore = __webpack_require__(1);\n\nvar cornerstone = _interopRequireWildcard(_cornerstoneCore);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction metaDataProvider(type, imageId) {\n  var parsedImageId = (0, _parseImageId2.default)(imageId);\n\n  if (!_dataSetCacheManager2.default.isLoaded(parsedImageId.url)) {\n    return;\n  }\n\n  var dataSet = _dataSetCacheManager2.default.get(parsedImageId.url);\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: dataSet.string('x00080060'),\n      seriesInstanceUID: dataSet.string('x0020000e'),\n      seriesNumber: dataSet.intString('x00200011'),\n      studyInstanceUID: dataSet.string('x0020000d'),\n      seriesDate: dicomParser.parseDA(dataSet.string('x00080021')),\n      seriesTime: dicomParser.parseTM(dataSet.string('x00080031') || '')\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: dataSet.intString('x00101010'),\n      patientSize: dataSet.floatString('x00101020'),\n      patientWeight: dataSet.floatString('x00101030')\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: (0, _getNumberValues2.default)(dataSet, 'x00280030', 2),\n      imageOrientationPatient: (0, _getNumberValues2.default)(dataSet, 'x00200037', 6),\n      imagePositionPatient: (0, _getNumberValues2.default)(dataSet, 'x00200032', 3),\n      sliceThickness: dataSet.floatString('x00180050'),\n      sliceLocation: dataSet.floatString('x00201041'),\n      frameOfReferenceUID: dataSet.string('x00200052')\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return (0, _getImagePixelModule2.default)(dataSet);\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      rescaleIntercept: dataSet.floatString('x00281052'),\n      rescaleSlope: dataSet.floatString('x00281053'),\n      rescaleType: dataSet.string('x00281054'),\n      modalityLUTSequence: (0, _getLUTs2.default)(dataSet.uint16('x00280103'), dataSet.elements.x00283000)\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    var modalityLUTOutputPixelRepresentation = (0, _getModalityLUTOutputPixelRepresentation2.default)(dataSet);\n\n    return {\n      windowCenter: (0, _getNumberValues2.default)(dataSet, 'x00281050', 1),\n      windowWidth: (0, _getNumberValues2.default)(dataSet, 'x00281051', 1),\n      voiLUTSequence: (0, _getLUTs2.default)(modalityLUTOutputPixelRepresentation, dataSet.elements.x00283010)\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: dataSet.string('x00080016'),\n      sopInstanceUID: dataSet.string('x00080018')\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    var radiopharmaceuticalInfo = dataSet.elements.x00540016;\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    var firstRadiopharmaceuticalInfoDataSet = radiopharmaceuticalInfo.items[0].dataSet;\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM(firstRadiopharmaceuticalInfoDataSet.string('x00181072') || ''),\n        radionuclideTotalDose: firstRadiopharmaceuticalInfoDataSet.floatString('x00181074'),\n        radionuclideHalfLife: firstRadiopharmaceuticalInfoDataSet.floatString('x00181075')\n      }\n    };\n  }\n}\n\n// register our metadata provider\ncornerstone.metaData.addProvider(metaDataProvider);\n\nexports.default = metaDataProvider;\n\n/***/ })\n/******/ ]);\n});\n\n\n// WEBPACK FOOTER //\n// cornerstoneWADOImageLoader.min.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 45);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 012e4b744080ee5fc464","module.exports = __WEBPACK_EXTERNAL_MODULE_0__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"jquery\",\"commonjs2\":\"jquery\",\"amd\":\"jquery\",\"root\":\"$\"}\n// module id = 0\n// module chunks = 0","module.exports = __WEBPACK_EXTERNAL_MODULE_1__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"cornerstone-core\",\"commonjs2\":\"cornerstone-core\",\"amd\":\"cornerstone-core\",\"root\":\"cornerstone\"}\n// module id = 1\n// module chunks = 0","import { default as xhrRequest } from './xhrRequest';\nimport { setOptions, getOptions } from './options';\n\nconst internal = {\n  xhrRequest,\n  setOptions,\n  getOptions\n};\n\nexport { setOptions, getOptions, xhrRequest, internal };\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/index.js","export default '0.14.6';\n\n\n\n// WEBPACK FOOTER //\n// ./version.js","/**\n * Returns the raw value\n *\n * @param element - The javascript object for the specified element in the metadata\n * @param {Number} [index] - the index of the value in a multi-valued element, default is 0\n * @param {*} [defaultValue] - The default value to return if the element does not exist\n * @returns {*}\n */\nexport default function (element, index = 0, defaultValue) {\n  if (!element) {\n    return defaultValue;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return defaultValue;\n  }\n  // make sure we have the specified index\n  if (element.Value.length <= index) {\n    return defaultValue;\n  }\n\n  return element.Value[index];\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getValue.js","/**\n * Build a url by parsing out the url scheme and frame index from the imageId\n *\n * @param imageId\n * @return {{scheme: string, url: string, frame: *}}\n */\nexport default function (imageId) {\n  const firstColonIndex = imageId.indexOf(':');\n  let url = imageId.substring(firstColonIndex + 1);\n  const frameIndex = url.indexOf('frame=');\n  let frame;\n\n  if (frameIndex !== -1) {\n    const frameStr = url.substr(frameIndex + 6);\n\n    frame = parseInt(frameStr, 10);\n    url = url.substr(0, frameIndex - 1);\n  }\n\n  return {\n    scheme: imageId.substr(0, firstColonIndex),\n    url,\n    frame\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/parseImageId.js","module.exports = __WEBPACK_EXTERNAL_MODULE_6__;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external {\"commonjs\":\"dicom-parser\",\"commonjs2\":\"dicom-parser\",\"amd\":\"dicom-parser\",\"root\":\"dicomParser\"}\n// module id = 6\n// module chunks = 0","import $ from 'jquery';\nimport getImageFrame from './getImageFrame';\nimport decodeImageFrame from './decodeImageFrame';\nimport isColorImageFn from './isColorImage';\nimport convertColorSpace from './convertColorSpace';\nimport getMinMax from './getMinMax';\nimport isJPEGBaseline8BitColor from './isJPEGBaseline8BitColor';\nimport * as cornerstone from 'cornerstone-core';\n\nlet lastImageIdDrawn = '';\n\n/**\n * Check whether the modality LUT is meant to be used for display purposes\n * For XA and XRF images, the modality LUT is not meant to be used.\n *\n * See https://groups.google.com/forum/#!searchin/comp.protocols.dicom/Modality$20LUT$20XA/comp.protocols.dicom/UBxhOZ2anJ0/D0R_QP8V2wIJ\n *\n * @param {String} sopClassUid\n * @return {boolean} Whether or not the Modality LUT should be used for image display\n */\nfunction isModalityLUTForDisplay (sopClassUid) {\n  return sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.1' && // XA\n         sopClassUid !== '1.2.840.10008.5.1.4.1.1.12.2.1'; // XRF\n}\n\n/**\n * Helper function to set pixel data to the right typed array.  This is needed because web workers\n * can transfer array buffers but not typed arrays\n * @param imageFrame\n */\nfunction setPixelDataType (imageFrame) {\n  if (imageFrame.bitsAllocated === 16) {\n    if (imageFrame.pixelRepresentation === 0) {\n      imageFrame.pixelData = new Uint16Array(imageFrame.pixelData);\n    } else {\n      imageFrame.pixelData = new Int16Array(imageFrame.pixelData);\n    }\n  } else {\n    imageFrame.pixelData = new Uint8Array(imageFrame.pixelData);\n  }\n}\n\n/**\n * Create an Image\n *\n * @param {String} imageId\n * @param {Array} pixelData\n * @param {String} transferSyntax\n * @param {Object} options\n *\n * @returns {Promise}\n */\nexport default function (imageId, pixelData, transferSyntax, options) {\n  const canvas = document.createElement('canvas');\n  const deferred = $.Deferred();\n  const imageFrame = getImageFrame(imageId);\n  const decodePromise = decodeImageFrame(imageFrame, transferSyntax, pixelData, canvas, options);\n\n  decodePromise.then(function (imageFrame) {\n    // var imagePixelModule = metaDataProvider('imagePixelModule', imageId);\n    const imagePlaneModule = cornerstone.metaData.get('imagePlaneModule', imageId) || {};\n    const voiLutModule = cornerstone.metaData.get('voiLutModule', imageId) || {};\n    const modalityLutModule = cornerstone.metaData.get('modalityLutModule', imageId) || {};\n    const sopCommonModule = cornerstone.metaData.get('sopCommonModule', imageId) || {};\n    const color = isColorImageFn(imageFrame.photometricInterpretation);\n\n    // JPEGBaseline (8 bits) is already returning the pixel data in the right format (rgba)\n    // because it's using a canvas to load and decode images.\n    if (!isJPEGBaseline8BitColor(imageFrame, transferSyntax)) {\n      setPixelDataType(imageFrame);\n\n      // convert color space\n      if (color) {\n        // setup the canvas context\n        canvas.height = imageFrame.rows;\n        canvas.width = imageFrame.columns;\n\n        const context = canvas.getContext('2d');\n        const imageData = context.createImageData(imageFrame.columns, imageFrame.rows);\n\n        convertColorSpace(imageFrame, imageData);\n        imageFrame.imageData = imageData;\n        imageFrame.pixelData = imageData.data;\n\n        // calculate smallest and largest PixelValue of the converted pixelData\n        const minMax = getMinMax(imageFrame.pixelData);\n\n        imageFrame.smallestPixelValue = minMax.min;\n        imageFrame.largestPixelValue = minMax.max;\n      }\n    }\n\n    const image = {\n      imageId,\n      color,\n      columns: imageFrame.columns,\n      rows: imageFrame.rows,\n      width: imageFrame.columns,\n      height: imageFrame.rows,\n      intercept: modalityLutModule.rescaleIntercept || 0,\n      slope: modalityLutModule.rescaleSlope || 1,\n      invert: imageFrame.photometricInterpretation === 'MONOCHROME1',\n      minPixelValue: imageFrame.smallestPixelValue,\n      maxPixelValue: imageFrame.largestPixelValue,\n      render: undefined, // set below\n      sizeInBytes: imageFrame.pixelData.length,\n      rowPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[0] : undefined,\n      columnPixelSpacing: imagePlaneModule.pixelSpacing ? imagePlaneModule.pixelSpacing[1] : undefined,\n      windowCenter: voiLutModule.windowCenter ? voiLutModule.windowCenter[0] : undefined,\n      windowWidth: voiLutModule.windowWidth ? voiLutModule.windowWidth[0] : undefined,\n      decodeTimeInMS: imageFrame.decodeTimeInMS\n    };\n\n    // add function to return pixel data\n    image.getPixelData = () => imageFrame.pixelData;\n\n    // Setup the renderer\n    if (image.color) {\n      image.render = cornerstone.renderColorImage;\n      image.getCanvas = function () {\n        if (lastImageIdDrawn === imageId) {\n          return canvas;\n        }\n\n        canvas.height = image.rows;\n        canvas.width = image.columns;\n        const context = canvas.getContext('2d');\n\n        context.putImageData(imageFrame.imageData, 0, 0);\n        lastImageIdDrawn = imageId;\n\n        return canvas;\n      };\n\n    } else {\n      image.render = cornerstone.renderGrayscaleImage;\n    }\n\n    // Modality LUT\n    if (modalityLutModule.modalityLUTSequence &&\n      modalityLutModule.modalityLUTSequence.length > 0 &&\n      isModalityLUTForDisplay(sopCommonModule.sopClassUID)) {\n      image.modalityLUT = modalityLutModule.modalityLUTSequence[0];\n    }\n\n    // VOI LUT\n    if (voiLutModule.voiLUTSequence &&\n      voiLutModule.voiLUTSequence.length > 0) {\n      image.voiLUT = voiLutModule.voiLUTSequence[0];\n    }\n\n    // set the ww/wc to cover the dynamic range of the image if no values are supplied\n    if (image.windowCenter === undefined || image.windowWidth === undefined) {\n      if (image.color) {\n        image.windowWidth = 255;\n        image.windowCenter = 128;\n      } else {\n        const maxVoi = image.maxPixelValue * image.slope + image.intercept;\n        const minVoi = image.minPixelValue * image.slope + image.intercept;\n\n        image.windowWidth = maxVoi - minVoi;\n        image.windowCenter = (maxVoi + minVoi) / 2;\n      }\n    }\n    deferred.resolve(image);\n  });\n\n  return deferred.promise();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/createImage.js","let options = {\n  // callback allowing customization of the xhr (e.g. adding custom auth headers, cors, etc)\n  beforeSend (/* xhr */) {\n  },\n  // callback allowing modification of newly created image objects\n  imageCreated (/* image */) {\n  },\n  strict: true\n};\n\nexport function setOptions (newOptions) {\n  options = newOptions;\n}\n\nexport function getOptions () {\n  return options;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/options.js","// TODO: Is this being used at all???\nlet imageIds = [];\n\nfunction add (imageId, metadata) {\n  imageIds[imageId] = metadata;\n}\n\nfunction get (imageId) {\n  return imageIds[imageId];\n}\n\nfunction remove (imageId) {\n  imageIds[imageId] = undefined;\n}\n\nfunction purge () {\n  imageIds = [];\n}\n\nexport default {\n  add,\n  get,\n  remove,\n  purge\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaDataManager.js","import $ from 'jquery';\nimport * as dicomParser from 'dicom-parser';\nimport { xhrRequest } from '../internal';\n\n/**\n * This object supports loading of DICOM P10 dataset from a uri and caching it so it can be accessed\n * by the caller.  This allows a caller to access the datasets without having to go through cornerstone's\n * image loader mechanism.  One reason a caller may need to do this is to determine the number of frames\n * in a multiframe sop instance so it can create the imageId's correctly.\n */\nlet loadedDataSets = {};\nlet promises = {};\n\n/**\n * Returns true if the wadouri for the specified index has been loaded\n *\n * @param uri\n * @return {boolean} Whether or not the DataSet is in the cache\n */\nfunction isLoaded (uri) {\n  return loadedDataSets[uri] !== undefined;\n}\n\n/**\n * Retrieve a loaded DataSet from the cache\n *\n * @param {String} uri\n * @return {DataSet}\n * @throws If the DataSet is not in the cache\n */\nfunction get (uri) {\n  // if already loaded return it right away\n  if (!loadedDataSets[uri]) {\n    throw new Error('dataSetCacheManager.get: DataSet has not been loaded yet');\n  }\n\n  return loadedDataSets[uri].dataSet;\n}\n\n/**\n * Loads the dicom dataset from the wadouri sp\n *\n * @param {String} uri\n * @param loadRequest\n * @param {String} imageId\n * @return {*}\n */\nfunction load (uri, loadRequest, imageId) {\n  loadRequest = loadRequest || xhrRequest;\n\n  // if already loaded return it right away\n  if (loadedDataSets[uri]) {\n    // console.log('using loaded dataset ' + uri);\n    const alreadyLoadedpromise = $.Deferred();\n\n    loadedDataSets[uri].cacheCount++;\n    alreadyLoadedpromise.resolve(loadedDataSets[uri].dataSet);\n\n    return alreadyLoadedpromise;\n  }\n\n  // if we are currently loading this uri, return its promise\n  if (promises[uri]) {\n    // console.log('returning existing load promise for ' + uri);\n    return promises[uri];\n  }\n\n  // console.log('loading ' + uri);\n\n  // This uri is not loaded or being loaded, load it via an xhrRequest\n  const promise = loadRequest(uri, imageId);\n\n  // handle success and failure of the XHR request load\n  const loadDeferred = $.Deferred();\n\n  promise.then(function (dicomPart10AsArrayBuffer/* , xhr*/) {\n    const byteArray = new Uint8Array(dicomPart10AsArrayBuffer);\n\n    // Reject the promise if parsing the dicom file fails\n    let dataSet;\n\n    try {\n      dataSet = dicomParser.parseDicom(byteArray);\n    } catch (error) {\n      loadDeferred.reject(error);\n\n      return;\n    }\n\n    loadedDataSets[uri] = {\n      dataSet,\n      cacheCount: 1\n    };\n    loadDeferred.resolve(dataSet);\n    // done loading, remove the promise\n    delete promises[uri];\n  }, function (error) {\n    loadDeferred.reject(error);\n  }).always(function () {\n      // error thrown, remove the promise\n    delete promises[uri];\n  });\n\n  promises[uri] = loadDeferred;\n\n  return loadDeferred;\n}\n\n/**\n * Remove the cached/loaded dicom dataset for the specified wadouri to free up memory\n *\n * @param {String} uri\n */\nfunction unload (uri) {\n  // console.log('unload for ' + uri);\n  if (loadedDataSets[uri]) {\n    loadedDataSets[uri].cacheCount--;\n    if (loadedDataSets[uri].cacheCount === 0) {\n      // console.log('removing loaded dataset for ' + uri);\n      delete loadedDataSets[uri];\n    }\n  }\n}\n\n/**\n * Removes all cached datasets from memory\n */\nfunction purge () {\n  loadedDataSets = {};\n  promises = {};\n}\n\nexport default {\n  isLoaded,\n  load,\n  unload,\n  purge,\n  get\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/dataSetCacheManager.js","export { default as convertRGBColorByPixel } from './convertRGBColorByPixel';\nexport { default as convertRGBColorByPlane } from './convertRGBColorByPlane';\nexport { default as convertYBRFullByPixel } from './convertYBRFullByPixel';\nexport { default as convertYBRFullByPlane } from './convertYBRFullByPlane';\nexport { default as convertPALETTECOLOR } from './convertPALETTECOLOR';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/index.js","import { convertRGBColorByPixel, convertRGBColorByPlane,\n         convertYBRFullByPixel, convertYBRFullByPlane,\n         convertPALETTECOLOR } from './colorSpaceConverters';\n\n/**\n * Convert an array from RGB color space to RGBA\n *\n * @param {ImageFrame} imageFrame\n * @param {CanvasPixelArray} rgbaBuffer\n */\nfunction convertRGB (imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    convertRGBColorByPixel(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    convertRGBColorByPlane(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\n/**\n * Convert an array from YBRFull color space to RGBA\n *\n * @param {ImageFrame} imageFrame\n * @param {CanvasPixelArray} rgbaBuffer\n */\nfunction convertYBRFull (imageFrame, rgbaBuffer) {\n  if (imageFrame.planarConfiguration === 0) {\n    convertYBRFullByPixel(imageFrame.pixelData, rgbaBuffer);\n  } else {\n    convertYBRFullByPlane(imageFrame.pixelData, rgbaBuffer);\n  }\n}\n\n/**\n * Convert the pixel data from the input color space to RGBA\n * based on the photometric interpretation of the image frame.\n *\n * @param {ImageFrame} imageFrame\n * @param {ImageData} imageData\n * @throws If the PhotometricInterpretation has no known color space conversion approach\n */\nexport default function convertColorSpace (imageFrame, imageData) {\n  const rgbaBuffer = imageData.data;\n  const photometricInterpretation = imageFrame.photometricInterpretation;\n\n  if (photometricInterpretation === 'RGB') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_RCT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_ICT') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'PALETTE COLOR') {\n    convertPALETTECOLOR(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_FULL_422') {\n    convertRGB(imageFrame, rgbaBuffer);\n  } else if (photometricInterpretation === 'YBR_FULL') {\n    convertYBRFull(imageFrame, rgbaBuffer);\n  } else {\n    throw new Error(`No color space conversion for photometric interpretation ${photometricInterpretation}`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/convertColorSpace.js","import webWorkerManager from './webWorkerManager';\nimport decodeJPEGBaseline8BitColor from './decodeJPEGBaseline8BitColor';\n\n/**\n * Add decode task\n *\n * @param imageFrame\n * @param transferSyntax\n * @param pixelData\n * @param options\n *\n * @return {Object}\n */\nfunction addDecodeTask (imageFrame, transferSyntax, pixelData, options) {\n  const priority = options.priority || undefined;\n  const transferList = options.transferPixelData ? [pixelData.buffer] : undefined;\n\n  return webWorkerManager.addTask(\n    'decodeTask',\n    {\n      imageFrame,\n      transferSyntax,\n      pixelData,\n      options\n    }, priority, transferList).promise;\n}\n\n/**\n * Decode image frame\n *\n * @param {ImageFrame} imageFrame\n * @param {String} transferSyntax\n * @param {Array} pixelData\n * @param {HTMLCanvasElement} canvas\n * @param {Object} options\n *\n * @return {Object}\n */\nfunction decodeImageFrame (imageFrame, transferSyntax, pixelData, canvas, options) {\n  options = options || {};\n\n  // TODO: Turn this into a switch statement instead\n  if (transferSyntax === '1.2.840.10008.1.2') {\n    // Implicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1') {\n    // Explicit VR Little Endian\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.2') {\n    // Explicit VR Big Endian (retired)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.1.99') {\n    // Deflate transfer syntax (deflated by dicomParser)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.5') {\n    // RLE Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.50') {\n    // JPEG Baseline lossy process 1 (8 bit)\n\n    // Handle 8-bit JPEG Baseline color images using the browser's built-in\n    // JPEG decoding\n    if (imageFrame.bitsAllocated === 8 &&\n       (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4)) {\n      return decodeJPEGBaseline8BitColor(imageFrame, pixelData, canvas);\n    }\n\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.51') {\n    // JPEG Baseline lossy process 2 & 4 (12 bit)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.57') {\n    // JPEG Lossless, Nonhierarchical (Processes 14)\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.70') {\n    // JPEG Lossless, Nonhierarchical (Processes 14 [Selection 1])\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.80') {\n    // JPEG-LS Lossless Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.81') {\n    // JPEG-LS Lossy (Near-Lossless) Image Compression\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.90') {\n    // JPEG 2000 Lossless\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  } else if (transferSyntax === '1.2.840.10008.1.2.4.91') {\n    // JPEG 2000 Lossy\n    return addDecodeTask(imageFrame, transferSyntax, pixelData, options);\n  }\n\n  /* Don't know if these work...\n   // JPEG 2000 Part 2 Multicomponent Image Compression (Lossless Only)\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.92\")\n   {\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\n   }\n   // JPEG 2000 Part 2 Multicomponent Image Compression\n   else if(transferSyntax === \"1.2.840.10008.1.2.4.93\")\n   {\n   return cornerstoneWADOImageLoader.decodeJPEG2000(dataSet, frame);\n   }\n   */\n\n  throw new Error(`No decoder for transfer syntax ${transferSyntax}`);\n}\n\nexport default decodeImageFrame;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/decodeImageFrame.js","import $ from 'jquery';\n\nfunction arrayBufferToString (buffer) {\n  return binaryToString(String.fromCharCode.apply(null, Array.prototype.slice.apply(new Uint8Array(buffer))));\n}\n\nfunction binaryToString (binary) {\n  let error;\n\n  try {\n    return decodeURIComponent(escape(binary));\n  } catch (_error) {\n    error = _error;\n    if (error instanceof URIError) {\n      return binary;\n    }\n    throw error;\n\n  }\n}\n\n/**\n * Special decoder for 8 bit jpeg that leverages the browser's built in JPEG decoder for increased performance\n *\n * @param {ImageFrame} imageFrame\n * @param {Uint8Array} pixelData\n * @param {HTMLCanvasElement} canvas\n */\nexport default function (imageFrame, pixelData, canvas) {\n  const start = new Date().getTime();\n  const deferred = $.Deferred();\n\n  const imgBlob = new Blob([pixelData], { type: 'image/jpeg' });\n\n  const r = new FileReader();\n\n  if (r.readAsBinaryString === undefined) {\n    r.readAsArrayBuffer(imgBlob);\n  } else {\n    r.readAsBinaryString(imgBlob); // doesn't work on IE11\n  }\n\n  r.onload = function () {\n    const img = new Image();\n\n    img.onload = function () {\n      canvas.height = img.height;\n      canvas.width = img.width;\n      imageFrame.rows = img.height;\n      imageFrame.columns = img.width;\n      const context = canvas.getContext('2d');\n\n      context.drawImage(this, 0, 0);\n      const imageData = context.getImageData(0, 0, img.width, img.height);\n      const end = new Date().getTime();\n\n      imageFrame.pixelData = imageData.data;\n      imageFrame.imageData = imageData;\n      imageFrame.decodeTimeInMS = end - start;\n      deferred.resolve(imageFrame);\n    };\n    img.onerror = function (error) {\n      deferred.reject(error);\n    };\n    if (r.readAsBinaryString === undefined) {\n      img.src = `data:image/jpeg;base64,${window.btoa(arrayBufferToString(r.result))}`;\n    } else {\n      img.src = `data:image/jpeg;base64,${window.btoa(r.result)}`; // doesn't work on IE11\n    }\n\n  };\n\n  return deferred.promise();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/decodeJPEGBaseline8BitColor.js","import * as cornerstone from 'cornerstone-core';\n\n/**\n * @typedef {Object} ImageFrame\n *\n * @param {Number} samplesPerPixel\n * @param {String} photometricInterpretation\n * @param {Number} planarConfiguration\n * @param {Number} rows\n * @param {Number} columns\n * @param {Number} bitsAllocated\n * @param {Number} pixelRepresentation\n * @param {Number} smallestPixelValue\n * @param {Number} largestPixelValue\n * @param {String} redPaletteColorLookupTableDescriptor\n * @param {String} greenPaletteColorLookupTableDescriptor\n * @param {String} bluePaletteColorLookupTableDescriptor\n * @param {Array} redPaletteColorLookupTableData\n * @param {Array} greenPaletteColorLookupTableData\n * @param {Array} bluePaletteColorLookupTableData\n * @param {Array} pixelData\n */\n\n/**\n * Construct an ImageFrame object from an image's metadata\n *\n * @param imageId The image id\n * @return {ImageFrame} The image frame structure\n */\nexport default function (imageId) {\n  const imagePixelModule = cornerstone.metaData.get('imagePixelModule', imageId);\n\n  return {\n    samplesPerPixel: imagePixelModule.samplesPerPixel,\n    photometricInterpretation: imagePixelModule.photometricInterpretation,\n    planarConfiguration: imagePixelModule.planarConfiguration,\n    rows: imagePixelModule.rows,\n    columns: imagePixelModule.columns,\n    bitsAllocated: imagePixelModule.bitsAllocated,\n    pixelRepresentation: imagePixelModule.pixelRepresentation, // 0 = unsigned,\n    smallestPixelValue: imagePixelModule.smallestPixelValue,\n    largestPixelValue: imagePixelModule.largestPixelValue,\n    redPaletteColorLookupTableDescriptor: imagePixelModule.redPaletteColorLookupTableDescriptor,\n    greenPaletteColorLookupTableDescriptor: imagePixelModule.greenPaletteColorLookupTableDescriptor,\n    bluePaletteColorLookupTableDescriptor: imagePixelModule.bluePaletteColorLookupTableDescriptor,\n    redPaletteColorLookupTableData: imagePixelModule.redPaletteColorLookupTableData,\n    greenPaletteColorLookupTableData: imagePixelModule.greenPaletteColorLookupTableData,\n    bluePaletteColorLookupTableData: imagePixelModule.bluePaletteColorLookupTableData,\n    pixelData: undefined // populated later after decoding\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/getImageFrame.js","/**\n * Calculate the minimum and maximum pixel values in the input\n * pixel data array\n *\n * @param storedPixelData\n * @return {{min: Number, max: Number}} Minimum and maximum values in the input array\n */\nexport default function (storedPixelData) {\n  let min = storedPixelData[0];\n  let max = storedPixelData[0];\n  const numPixels = storedPixelData.length;\n\n  for (let index = 0; index < numPixels; index++) {\n    const storedPixel = storedPixelData[index];\n\n    min = Math.min(min, storedPixel);\n    max = Math.max(max, storedPixel);\n  }\n\n  return {\n    min,\n    max\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/getMinMax.js","/**\n * Check whether the photometric interpretation value for an image\n * represents a color image.\n *\n * @param {String} photometricInterpretation The Photometric Interpretation value\n * @return {boolean} Whether or not this is a color data type\n */\nexport default function (photometricInterpretation) {\n  return (photometricInterpretation === 'RGB' ||\n    photometricInterpretation === 'PALETTE COLOR' ||\n    photometricInterpretation === 'YBR_FULL' ||\n    photometricInterpretation === 'YBR_FULL_422' ||\n    photometricInterpretation === 'YBR_PARTIAL_422' ||\n    photometricInterpretation === 'YBR_PARTIAL_420' ||\n    photometricInterpretation === 'YBR_RCT' ||\n    photometricInterpretation === 'YBR_ICT');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/isColorImage.js","/**\n * Check if an image is an 8-bit JPEGBaseline color image\n *\n * @param {Object} imageFrame\n * @param {String} transferSyntax The image's transfer syntax\n * @return {boolean} Whether or not the image is a 8-bit JPEGBaseline color image\n */\nexport default function (imageFrame, transferSyntax) {\n  transferSyntax = transferSyntax || imageFrame.transferSyntax;\n\n  return (imageFrame.bitsAllocated === 8 &&\n     transferSyntax === '1.2.840.10008.1.2.4.50' &&\n     (imageFrame.samplesPerPixel === 3 || imageFrame.samplesPerPixel === 4));\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/isJPEGBaseline8BitColor.js","import $ from 'jquery';\nimport { getOptions } from './internal/options';\n\n// the taskId to assign to the next task added via addTask()\nlet nextTaskId = 0;\n\n// array of queued tasks sorted with highest priority task first\nconst tasks = [];\n\n// array of web workers to dispatch decode tasks to\nconst webWorkers = [];\n\n// The options for CornerstoneWADOImageLoader\nconst options = getOptions();\n\nconst defaultConfig = {\n  maxWebWorkers: navigator.hardwareConcurrency || 1,\n  startWebWorkersOnDemand: true,\n  webWorkerPath: '../../dist/cornerstoneWADOImageLoaderWebWorker.js',\n  webWorkerTaskPaths: [],\n  taskConfiguration: {\n    decodeTask: {\n      loadCodecsOnStartup: true,\n      initializeCodecsOnStartup: false,\n      codecsPath: '../dist/cornerstoneWADOImageLoaderCodecs.js',\n      usePDFJS: false,\n      strict: options.strict\n    }\n  }\n};\n\nlet config;\n\nconst statistics = {\n  maxWebWorkers: 0,\n  numWebWorkers: 0,\n  numTasksQueued: 0,\n  numTasksExecuting: 0,\n  numTasksCompleted: 0,\n  totalTaskTimeInMS: 0,\n  totalTimeDelayedInMS: 0\n};\n\n/**\n * Function to start a task on a web worker\n */\nfunction startTaskOnWebWorker () {\n  // return immediately if no decode tasks to do\n  if (!tasks.length) {\n    return;\n  }\n\n  // look for a web worker that is ready\n  for (let i = 0; i < webWorkers.length; i++) {\n    if (webWorkers[i].status === 'ready') {\n      // mark it as busy so tasks are not assigned to it\n      webWorkers[i].status = 'busy';\n\n      // get the highest priority task\n      const task = tasks.shift();\n\n      task.start = new Date().getTime();\n\n      // update stats with how long this task was delayed (waiting in queue)\n      const end = new Date().getTime();\n\n      statistics.totalTimeDelayedInMS += end - task.added;\n\n      // assign this task to this web worker and send the web worker\n      // a message to execute it\n      webWorkers[i].task = task;\n      webWorkers[i].worker.postMessage({\n        taskType: task.taskType,\n        workerIndex: i,\n        data: task.data\n      }, task.transferList);\n      statistics.numTasksExecuting++;\n\n      return;\n    }\n  }\n\n  // if no available web workers and we haven't started max web workers, start a new one\n  if (webWorkers.length < config.maxWebWorkers) {\n    spawnWebWorker();\n  }\n}\n\n/**\n * Function to handle a message from a web worker\n * @param msg\n */\nfunction handleMessageFromWorker (msg) {\n  // console.log('handleMessageFromWorker', msg.data);\n  if (msg.data.taskType === 'initialize') {\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    startTaskOnWebWorker();\n  } else {\n    const start = webWorkers[msg.data.workerIndex].task.start;\n\n    webWorkers[msg.data.workerIndex].task.deferred.resolve(msg.data.result);\n    webWorkers[msg.data.workerIndex].task = undefined;\n\n    statistics.numTasksExecuting--;\n    webWorkers[msg.data.workerIndex].status = 'ready';\n    statistics.numTasksCompleted++;\n\n    const end = new Date().getTime();\n\n    statistics.totalTaskTimeInMS += end - start;\n\n    startTaskOnWebWorker();\n  }\n}\n\n/**\n * Spawns a new web worker\n */\nfunction spawnWebWorker () {\n  // prevent exceeding maxWebWorkers\n  if (webWorkers.length >= config.maxWebWorkers) {\n    return;\n  }\n\n  // spawn the webworker\n  const worker = new Worker(config.webWorkerPath);\n\n  webWorkers.push({\n    worker,\n    status: 'initializing'\n  });\n  worker.addEventListener('message', handleMessageFromWorker);\n  worker.postMessage({\n    taskType: 'initialize',\n    workerIndex: webWorkers.length - 1,\n    config\n  });\n}\n\n/**\n * Initialization function for the web worker manager - spawns web workers\n * @param configObject\n */\nfunction initialize (configObject) {\n  configObject = configObject || defaultConfig;\n\n  // prevent being initialized more than once\n  if (config) {\n    throw new Error('WebWorkerManager already initialized');\n  }\n\n  config = configObject;\n\n  config.maxWebWorkers = config.maxWebWorkers || (navigator.hardwareConcurrency || 1);\n\n  // Spawn new web workers\n  if (!config.startWebWorkersOnDemand) {\n    for (let i = 0; i < config.maxWebWorkers; i++) {\n      spawnWebWorker();\n    }\n  }\n}\n\n/**\n * dynamically loads a web worker task\n * @param sourcePath\n * @param taskConfig\n */\nfunction loadWebWorkerTask (sourcePath, taskConfig) {\n  // add it to the list of web worker tasks paths so on demand web workers\n  // load this properly\n  config.webWorkerTaskPaths.push(sourcePath);\n\n  // if a task specific configuration is provided, merge it into the config\n  if (taskConfig) {\n    config.taskConfiguration = Object.assign(config.taskConfiguration, taskConfig);\n  }\n\n  // tell each spawned web worker to load this task\n  for (let i = 0; i < webWorkers.length; i++) {\n    webWorkers[i].worker.postMessage({\n      taskType: 'loadWebWorkerTask',\n      workerIndex: webWorkers.length - 1,\n      sourcePath,\n      config\n    });\n  }\n}\n\n/**\n * Function to add a decode task to be performed\n *\n * @param taskType - the taskType for this task\n * @param data - data specific to the task\n * @param priority - optional priority of the task (defaults to 0), > 0 is higher, < 0 is lower\n * @param transferList - optional array of data to transfer to web worker\n *\n * @returns {Object}\n */\nfunction addTask (taskType, data, priority = 0, transferList) {\n  if (!config) {\n    initialize();\n  }\n\n  const deferred = $.Deferred();\n\n  // find the right spot to insert this decode task (based on priority)\n  let i;\n\n  for (i = 0; i < tasks.length; i++) {\n    if (tasks[i].priority <= priority) {\n      break;\n    }\n  }\n\n  const taskId = nextTaskId++;\n\n  // insert the decode task at position i\n  tasks.splice(i, 0, {\n    taskId,\n    taskType,\n    status: 'ready',\n    added: new Date().getTime(),\n    data,\n    deferred,\n    priority,\n    transferList\n  });\n\n  // try to start a task on the web worker since we just added a new task and a web worker may be available\n  startTaskOnWebWorker();\n\n  return {\n    taskId,\n    promise: deferred.promise()\n  };\n}\n\n/**\n * Changes the priority of a queued task\n * @param taskId - the taskId to change the priority of\n * @param priority - priority of the task (defaults to 0), > 0 is higher, < 0 is lower\n * @returns boolean - true on success, false if taskId not found\n */\nfunction setTaskPriority (taskId, priority = 0) {\n  // search for this taskId\n  for (let i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      const task = tasks.splice(i, 1)[0];\n\n      // set its priority\n      task.priority = priority;\n\n      // find the right spot to insert this decode task (based on priority)\n      for (i = 0; i < tasks.length; i++) {\n        if (tasks[i].priority <= priority) {\n          break;\n        }\n      }\n\n      // insert the decode task at position i\n      tasks.splice(i, 0, task);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Cancels a queued task and rejects\n * @param taskId - the taskId to cancel\n * @param reason - optional reason the task was rejected\n * @returns boolean - true on success, false if taskId not found\n */\nfunction cancelTask (taskId, reason) {\n  // search for this taskId\n  for (let i = 0; i < tasks.length; i++) {\n    if (tasks[i].taskId === taskId) {\n      // taskId found, remove it\n      const task = tasks.splice(i, 1);\n\n      task.promise.reject(reason);\n\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Function to return the statistics on running web workers\n * @returns object containing statistics\n */\nfunction getStatistics () {\n  statistics.maxWebWorkers = config.maxWebWorkers;\n  statistics.numWebWorkers = webWorkers.length;\n  statistics.numTasksQueued = tasks.length;\n\n  return statistics;\n}\n\nexport default {\n  initialize,\n  loadWebWorkerTask,\n  addTask,\n  getStatistics,\n  setTaskPriority,\n  cancelTask\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/webWorkerManager.js","import stringToUint8Array from './stringToUint8Array';\n\n/**\n * checkToken\n *\n * @param token\n * @param data\n * @param dataOffset\n * @return {boolean}\n */\nfunction checkToken (token, data, dataOffset) {\n  if (dataOffset + token.length > data.length) {\n    return false;\n  }\n\n  let endIndex = dataOffset;\n\n  for (let i = 0; i < token.length; i++) {\n    if (token[i] !== data[endIndex++]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n *\n * @param data\n * @param str\n * @param offset\n * @return {*}\n */\nexport default function findIndexOfString (data, str, offset) {\n\n  offset = offset || 0;\n\n  const token = stringToUint8Array(str);\n\n  for (let i = offset; i < data.length; i++) {\n    if (token[0] === data[i]) {\n      // console.log('match @', i);\n      if (checkToken(token, data, i)) {\n        return i;\n      }\n    }\n  }\n\n  return -1;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/findIndexOfString.js","import $ from 'jquery';\nimport { xhrRequest } from '../internal';\nimport findIndexOfString from './findIndexOfString';\nimport uint8ArrayToString from './uint8ArrayToString';\n\n/**\n *\n * @param header\n * @return {*}\n */\nfunction findBoundary (header) {\n  for (let i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 2) === '--') {\n      return header[i];\n    }\n  }\n}\n\n/**\n *\n * @param header\n * @return {String|Undefined}\n */\nfunction findContentType (header) {\n  for (let i = 0; i < header.length; i++) {\n    if (header[i].substr(0, 13) === 'Content-Type:') {\n      return header[i].substr(13).trim();\n    }\n  }\n}\n\n/**\n *\n * @param {String} uri\n * @param {String} imageId\n * @param {String} mediaType\n * @returns {Promise}\n */\nexport default function (uri, imageId, mediaType) {\n  mediaType = mediaType || 'application/octet-stream';\n  const headers = {\n    accept: mediaType\n  };\n\n  const deferred = $.Deferred();\n\n  const loadPromise = xhrRequest(uri, imageId, headers);\n\n  loadPromise.then(function (imageFrameAsArrayBuffer/* , xhr*/) {\n\n    // request succeeded, Parse the multi-part mime response\n    const response = new Uint8Array(imageFrameAsArrayBuffer);\n\n    // First look for the multipart mime header\n    const tokenIndex = findIndexOfString(response, '\\r\\n\\r\\n');\n\n    if (tokenIndex === -1) {\n      deferred.reject('invalid response - no multipart mime header');\n    }\n    const header = uint8ArrayToString(response, 0, tokenIndex);\n\n    // Now find the boundary marker\n    const split = header.split('\\r\\n');\n    const boundary = findBoundary(split);\n\n    if (!boundary) {\n      deferred.reject('invalid response - no boundary marker');\n    }\n    const offset = tokenIndex + 4; // skip over the \\r\\n\\r\\n\n\n    // find the terminal boundary marker\n    const endIndex = findIndexOfString(response, boundary, offset);\n\n    if (endIndex === -1) {\n      deferred.reject('invalid response - terminating boundary not found');\n    }\n\n    // Remove \\r\\n from the length\n    const length = endIndex - offset - 2;\n\n    // return the info for this pixel data\n    deferred.resolve({\n      contentType: findContentType(split),\n      imageFrame: {\n        pixelData: new Uint8Array(imageFrameAsArrayBuffer, offset, length)\n      }\n    });\n  });\n\n  return deferred.promise();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/getPixelData.js","import getValue from './getValue';\n\n/**\n *\n * @param element\n * @param {Number} index\n * @return {Number|Undefined}\n */\nexport default function (element, index) {\n  const value = getValue(element, index);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberValue.js","/**\n * Returns the values as an array of numbers\n *\n * @param element - The javascript object for the specified element in the metadata\n * @param {Number} [minimumLength] - the minimum number of values\n * @returns {Array|Undefined}\n */\nexport default function (element, minimumLength) {\n  if (!element) {\n    return;\n  }\n  // Value is not present if the attribute has a zero length value\n  if (!element.Value) {\n    return;\n  }\n  // make sure we have the expected length\n  if (minimumLength && element.Value.length < minimumLength) {\n    return;\n  }\n\n  const values = [];\n\n  for (let i = 0; i < element.Value.length; i++) {\n    values.push(parseFloat(element.Value[i]));\n  }\n\n  return values;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberValues.js","let files = [];\n\n/**\n * Adds a file to the file manager\n *\n * @param file\n * @return {string} An imageId for the added file\n */\nfunction add (file) {\n  const fileIndex = files.push(file);\n\n  return `dicomfile:${fileIndex - 1}`;\n}\n\n/**\n * Retrieve the file at a specific index in the fileManager\n *\n * @param {Number} index\n * @return {*}\n */\nfunction get (index) {\n  return files[index];\n}\n\n/**\n * Remove the file at a specific index in the fileManager\n *\n * @param {Number} index\n */\nfunction remove (index) {\n  files[index] = undefined;\n}\n\n/**\n * Erase all files stored in the file manager\n */\nfunction purge () {\n  files = [];\n}\n\nexport default {\n  add,\n  get,\n  remove,\n  purge\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/fileManager.js","import * as dicomParser from 'dicom-parser';\n\n/**\n *\n * @param dataSet\n * @return {boolean} Whether or not the frames are fragmented\n */\nfunction framesAreFragmented (dataSet) {\n  const numberOfFrames = dataSet.intString('x00280008');\n  const pixelDataElement = dataSet.elements.x7fe00010;\n\n  return (numberOfFrames !== pixelDataElement.fragments.length);\n}\n\n/**\n * Function to deal with extracting an image frame from an encapsulated data set.\n *\n * @param dataSet\n * @param frameIndex\n * @return {*}\n */\nexport default function getEncapsulatedImageFrame (dataSet, frameIndex) {\n  if (dataSet.elements.x7fe00010.basicOffsetTable.length) {\n    // Basic Offset Table is not empty\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex);\n  }\n\n  // Empty basic offset table\n  if (framesAreFragmented(dataSet)) {\n    const basicOffsetTable = dicomParser.createJPEGBasicOffsetTable(dataSet, dataSet.elements.x7fe00010);\n\n    return dicomParser.readEncapsulatedImageFrame(dataSet, dataSet.elements.x7fe00010, frameIndex, basicOffsetTable);\n  }\n\n  return dicomParser.readEncapsulatedPixelDataFromFragments(dataSet, dataSet.elements.x7fe00010, frameIndex);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getEncapsulatedImageFrame.js","import unpackBinaryFrame from './unpackBinaryFrame';\n\n/**\n * Function to deal with extracting an image frame from an encapsulated data set.\n *\n * @param {DataSet} dataSet\n * @param {Number} frameIndex\n * @return {*}\n * @throws If the specified frameIndex is outside the byte array\n */\nexport default function (dataSet, frameIndex) {\n  const pixelDataElement = dataSet.elements.x7fe00010;\n  const bitsAllocated = dataSet.uint16('x00280100');\n  const rows = dataSet.uint16('x00280010');\n  const columns = dataSet.uint16('x00280011');\n  const samplesPerPixel = dataSet.uint16('x00280002');\n\n  const pixelDataOffset = pixelDataElement.dataOffset;\n  const pixelsPerFrame = rows * columns * samplesPerPixel;\n\n  let frameOffset;\n\n  if (bitsAllocated === 8) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame);\n  } else if (bitsAllocated === 16) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 2;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return new Uint8Array(dataSet.byteArray.buffer, frameOffset, pixelsPerFrame * 2);\n  } else if (bitsAllocated === 1) {\n    frameOffset = pixelDataOffset + frameIndex * pixelsPerFrame * 0.125;\n    if (frameOffset >= dataSet.byteArray.length) {\n      throw new Error('frame exceeds size of pixelData');\n    }\n\n    return unpackBinaryFrame(dataSet.byteArray, frameOffset, pixelsPerFrame);\n  }\n\n  throw new Error('unsupported pixel format');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/getUncompressedImageFrame.js","import $ from 'jquery';\nimport parseImageId from './parseImageId';\nimport fileManager from './fileManager';\n\n/**\n * Loads a file using the browser(?)\n *\n * @param uri\n * @returns {Promise}\n */\nexport default function (uri) {\n  const parsedImageId = parseImageId(uri);\n  const fileIndex = parseInt(parsedImageId.url, 10);\n  const file = fileManager.get(fileIndex);\n  const deferred = $.Deferred();\n  const fileReader = new FileReader();\n\n  fileReader.onload = function (e) {\n    const dicomPart10AsArrayBuffer = e.target.result;\n\n    deferred.resolve(dicomPart10AsArrayBuffer);\n  };\n\n  fileReader.readAsArrayBuffer(file);\n\n  return deferred.promise();\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/loadFileRequest.js","\n\nfunction getLutDescriptor (dataSet, tag) {\n  if (!dataSet.elements[tag] || dataSet.elements[tag].length !== 6) {\n    return;\n  }\n\n  return [dataSet.uint16(tag, 0), dataSet.uint16(tag, 1), dataSet.uint16(tag, 2)];\n}\n\nfunction getLutData (lutDataSet, tag, lutDescriptor) {\n  const lut = [];\n  const lutData = lutDataSet.elements[tag];\n  const numLutEntries = lutDescriptor[0];\n\n  for (let i = 0; i < numLutEntries; i++) {\n    // Output range is always unsigned\n    if (lutDescriptor[2] === 16) {\n      lut[i] = lutDataSet.uint16(tag, i);\n    } else {\n      lut[i] = lutDataSet.byteArray[i + lutData.dataOffset];\n    }\n  }\n\n  return lut;\n}\n\nfunction populatePaletteColorLut (dataSet, imagePixelModule) {\n  // return immediately if photometric interpretation is not PALETTE COLOR or no palette lut elements\n  if (imagePixelModule.photometricInterpretation !== 'PALETTE COLOR' || !dataSet.elements.x00281101) {\n    return;\n  }\n  imagePixelModule.redPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281101');\n  imagePixelModule.greenPaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281102');\n  imagePixelModule.bluePaletteColorLookupTableDescriptor = getLutDescriptor(dataSet, 'x00281103');\n\n  imagePixelModule.redPaletteColorLookupTableData = getLutData(dataSet, 'x00281201', imagePixelModule.redPaletteColorLookupTableDescriptor);\n  imagePixelModule.greenPaletteColorLookupTableData = getLutData(dataSet, 'x00281202', imagePixelModule.greenPaletteColorLookupTableDescriptor);\n  imagePixelModule.bluePaletteColorLookupTableData = getLutData(dataSet, 'x00281203', imagePixelModule.bluePaletteColorLookupTableDescriptor);\n}\n\nfunction populateSmallestLargestPixelValues (dataSet, imagePixelModule) {\n  const pixelRepresentation = dataSet.uint16('x00280103');\n\n  if (pixelRepresentation === 0) {\n    imagePixelModule.smallestPixelValue = dataSet.uint16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.uint16('x00280107');\n  } else {\n    imagePixelModule.smallestPixelValue = dataSet.int16('x00280106');\n    imagePixelModule.largestPixelValue = dataSet.int16('x00280107');\n  }\n}\n\nfunction getImagePixelModule (dataSet) {\n\n  const imagePixelModule = {\n    samplesPerPixel: dataSet.uint16('x00280002'),\n    photometricInterpretation: dataSet.string('x00280004'),\n    rows: dataSet.uint16('x00280010'),\n    columns: dataSet.uint16('x00280011'),\n    bitsAllocated: dataSet.uint16('x00280100'),\n    bitsStored: dataSet.uint16('x00280101'),\n    highBit: dataSet.uint16('x00280102'),\n    pixelRepresentation: dataSet.uint16('x00280103'),\n    planarConfiguration: dataSet.uint16('x00280006'),\n    pixelAspectRatio: dataSet.string('x00280034')\n  };\n\n  populateSmallestLargestPixelValues(dataSet, imagePixelModule);\n  populatePaletteColorLut(dataSet, imagePixelModule);\n\n  return imagePixelModule;\n\n}\n\nexport default getImagePixelModule;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getImagePixelModule.js","\n\nfunction getLUT (pixelRepresentation, lutDataSet) {\n  let numLUTEntries = lutDataSet.uint16('x00283002', 0);\n\n  if (numLUTEntries === 0) {\n    numLUTEntries = 65535;\n  }\n  let firstValueMapped = 0;\n\n  if (pixelRepresentation === 0) {\n    firstValueMapped = lutDataSet.uint16('x00283002', 1);\n  } else {\n    firstValueMapped = lutDataSet.int16('x00283002', 1);\n  }\n  const numBitsPerEntry = lutDataSet.uint16('x00283002', 2);\n  // console.log('LUT(', numLUTEntries, ',', firstValueMapped, ',', numBitsPerEntry, ')');\n  const lut = {\n    id: '1',\n    firstValueMapped,\n    numBitsPerEntry,\n    lut: []\n  };\n\n  // console.log(\"minValue=\", minValue, \"; maxValue=\", maxValue);\n  for (let i = 0; i < numLUTEntries; i++) {\n    if (pixelRepresentation === 0) {\n      lut.lut[i] = lutDataSet.uint16('x00283006', i);\n    } else {\n      lut.lut[i] = lutDataSet.int16('x00283006', i);\n    }\n  }\n\n  return lut;\n}\n\n\nfunction getLUTs (pixelRepresentation, lutSequence) {\n  if (!lutSequence || !lutSequence.items.length) {\n    return;\n  }\n  const luts = [];\n\n  for (let i = 0; i < lutSequence.items.length; i++) {\n    const lutDataSet = lutSequence.items[i].dataSet;\n    const lut = getLUT(pixelRepresentation, lutDataSet);\n\n    if (lut) {\n      luts.push(lut);\n    }\n  }\n\n  return luts;\n}\n\nexport default getLUTs;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getLUTs.js","/* eslint no-bitwise: 0 */\n\nfunction getMinStoredPixelValue (dataSet) {\n  const pixelRepresentation = dataSet.uint16('x00280103');\n  const bitsStored = dataSet.uint16('x00280101');\n\n  if (pixelRepresentation === 0) {\n    return 0;\n  }\n\n  return -1 << (bitsStored - 1);\n}\n\n// 0 = unsigned / US, 1 = signed / SS\nfunction getModalityLUTOutputPixelRepresentation (dataSet) {\n\n  // CT SOP Classes are always signed\n  const sopClassUID = dataSet.string('x00080016');\n\n  if (sopClassUID === '1.2.840.10008.5.1.4.1.1.2' ||\n    sopClassUID === '1.2.840.10008.5.1.4.1.1.2.1') {\n    return 1;\n  }\n\n  // if rescale intercept and rescale slope are present, pass the minimum stored\n  // pixel value through them to see if we get a signed output range\n  const rescaleIntercept = dataSet.floatString('x00281052');\n  const rescaleSlope = dataSet.floatString('x00281053');\n\n  if (rescaleIntercept !== undefined && rescaleSlope !== undefined) {\n    const minStoredPixelValue = getMinStoredPixelValue(dataSet); //\n    const minModalityLutValue = minStoredPixelValue * rescaleSlope + rescaleIntercept;\n\n    if (minModalityLutValue < 0) {\n      return 1;\n    }\n\n    return 0;\n\n  }\n\n  // Output of non linear modality lut is always unsigned\n  if (dataSet.elements.x00283000 && dataSet.elements.x00283000.length > 0) {\n    return 0;\n  }\n\n  // If no modality lut transform, output is same as pixel representation\n  return dataSet.uint16('x00280103');\n}\n\nexport default getModalityLUTOutputPixelRepresentation;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getModalityLUTOutputPixelRepresentation.js","function getNumberValues (dataSet, tag, minimumLength) {\n  const values = [];\n  const valueAsString = dataSet.string(tag);\n\n  if (!valueAsString) {\n    return;\n  }\n  const split = valueAsString.split('\\\\');\n\n  if (minimumLength && split.length < minimumLength) {\n    return;\n  }\n  for (let i = 0; i < split.length; i++) {\n    values.push(parseFloat(split[i]));\n  }\n\n  return values;\n}\n\nexport default getNumberValues;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/getNumberValues.js","/* eslint no-bitwise: 0 */\n\n/**\n * Check whether a bit position is set inside a byte\n *\n * @param {Number} byte The input byte\n * @param {Number} bitPos The bit position\n * @return {Boolean} Whether or not the bit is set\n */\nfunction isBitSet (byte, bitPos) {\n  return Boolean(byte & (1 << bitPos));\n}\n\n/**\n * Function to deal with unpacking a binary frame\n *\n * @param byteArray\n * @param {Number} frameOffset\n * @param pixelsPerFrame\n *\n * @return {Uint8Array}\n */\nexport default function (byteArray, frameOffset, pixelsPerFrame) {\n  // Create a new pixel array given the image size\n  const pixelData = new Uint8Array(pixelsPerFrame);\n\n  for (let i = 0; i < pixelsPerFrame; i++) {\n    // Compute byte position\n    const bytePos = Math.floor(i / 8);\n\n    // Get the current byte\n    const byte = byteArray[bytePos + frameOffset];\n\n    // Bit position (0-7) within byte\n    const bitPos = (i % 8);\n\n    // Check whether bit at bitpos is set\n    pixelData[i] = isBitSet(byte, bitPos) ? 1 : 0;\n  }\n\n  return pixelData;\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/unpackBinaryFrame.js","import { setOptions } from './internal';\n\n/**\n * Configures CornerstoneWADOImageLoader with the supplied options.\n * Note: Overwrites all currently set options.\n *\n * @param {Object} options\n */\nexport default function (options) {\n  setOptions(options);\n}\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/configure.js","import { getNumberString,\n         getNumberValue,\n         getNumberValues,\n         getValue,\n         metaDataProvider } from './metaData';\n\nimport findIndexOfString from './findIndexOfString';\nimport getPixelData from './getPixelData';\nimport metaDataManager from './metaDataManager';\nimport loadImage from './loadImage';\n\nconst metaData = {\n  getNumberString,\n  getNumberValue,\n  getNumberValues,\n  getValue,\n  metaDataProvider\n};\n\nexport default {\n  metaData,\n  findIndexOfString,\n  getPixelData,\n  loadImage,\n  metaDataManager\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/index.js","import { getImagePixelModule,\n         getLUTs,\n         getModalityLUTOutputPixelRepresentation,\n         getNumberValues,\n         metaDataProvider } from './metaData';\n\nimport dataSetCacheManager from './dataSetCacheManager';\nimport fileManager from './fileManager';\nimport getEncapsulatedImageFrame from './getEncapsulatedImageFrame';\nimport getUncompressedImageFrame from './getUncompressedImageFrame';\nimport loadFileRequest from './loadFileRequest';\nimport { loadImageFromPromise,\n         getLoaderForScheme,\n         loadImage } from './loadImage';\n\nimport parseImageId from './parseImageId';\nimport unpackBinaryFrame from './unpackBinaryFrame';\n\nconst metaData = {\n  getImagePixelModule,\n  getLUTs,\n  getModalityLUTOutputPixelRepresentation,\n  getNumberValues,\n  metaDataProvider\n};\n\nexport default {\n  metaData,\n  dataSetCacheManager,\n  fileManager,\n  getEncapsulatedImageFrame,\n  getUncompressedImageFrame,\n  loadFileRequest,\n  loadImageFromPromise,\n  getLoaderForScheme,\n  loadImage,\n  parseImageId,\n  unpackBinaryFrame\n};\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/index.js","/* eslint no-bitwise: 0 */\n\nexport default function (imageFrame, rgbaBuffer) {\n  const numPixels = imageFrame.columns * imageFrame.rows;\n  let palIndex = 0;\n  let rgbaIndex = 0;\n  const pixelData = imageFrame.pixelData;\n  const start = imageFrame.redPaletteColorLookupTableDescriptor[1];\n  const rData = imageFrame.redPaletteColorLookupTableData;\n  const gData = imageFrame.greenPaletteColorLookupTableData;\n  const bData = imageFrame.bluePaletteColorLookupTableData;\n  const shift = imageFrame.redPaletteColorLookupTableDescriptor[2] === 8 ? 0 : 8;\n  let len = imageFrame.redPaletteColorLookupTableData.length;\n\n  if (len === 0) {\n    len = 65535;\n  }\n\n  for (let i = 0; i < numPixels; ++i) {\n    let value = pixelData[palIndex++];\n\n    if (value < start) {\n      value = 0;\n    } else if (value > start + len - 1) {\n      value = len - 1;\n    } else {\n      value -= start;\n    }\n\n    rgbaBuffer[rgbaIndex++] = rData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = gData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = bData[value] >> shift;\n    rgbaBuffer[rgbaIndex++] = 255;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertPALETTECOLOR.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let rgbIndex = 0;\n  let rgbaIndex = 0;\n\n  for (let i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[rgbIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertRGBColorByPixel.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: rgbBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: rgbBuffer length must be divisible by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let rgbaIndex = 0;\n  let rIndex = 0;\n  let gIndex = numPixels;\n  let bIndex = numPixels * 2;\n\n  for (let i = 0; i < numPixels; i++) {\n    rgbaBuffer[rgbaIndex++] = imageFrame[rIndex++]; // red\n    rgbaBuffer[rgbaIndex++] = imageFrame[gIndex++]; // green\n    rgbaBuffer[rgbaIndex++] = imageFrame[bIndex++]; // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertRGBColorByPlane.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let ybrIndex = 0;\n  let rgbaIndex = 0;\n\n  for (let i = 0; i < numPixels; i++) {\n    const y = imageFrame[ybrIndex++];\n    const cb = imageFrame[ybrIndex++];\n    const cr = imageFrame[ybrIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertYBRFullByPixel.js","export default function (imageFrame, rgbaBuffer) {\n  if (imageFrame === undefined) {\n    throw new Error('decodeRGB: ybrBuffer must not be undefined');\n  }\n  if (imageFrame.length % 3 !== 0) {\n    throw new Error('decodeRGB: ybrBuffer length must be divisble by 3');\n  }\n\n  const numPixels = imageFrame.length / 3;\n  let rgbaIndex = 0;\n  let yIndex = 0;\n  let cbIndex = numPixels;\n  let crIndex = numPixels * 2;\n\n  for (let i = 0; i < numPixels; i++) {\n    const y = imageFrame[yIndex++];\n    const cb = imageFrame[cbIndex++];\n    const cr = imageFrame[crIndex++];\n\n    rgbaBuffer[rgbaIndex++] = y + 1.40200 * (cr - 128);// red\n    rgbaBuffer[rgbaIndex++] = y - 0.34414 * (cb - 128) - 0.71414 * (cr - 128); // green\n    rgbaBuffer[rgbaIndex++] = y + 1.77200 * (cb - 128); // blue\n    rgbaBuffer[rgbaIndex++] = 255; // alpha\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/colorSpaceConverters/convertYBRFullByPlane.js","export * from './colorSpaceConverters';\n\nexport { default as wadouri } from './wadouri';\nexport { default as wadors } from './wadors';\nexport { default as configure } from './configure';\nexport { default as convertColorSpace } from './convertColorSpace';\nexport { default as createImage } from './createImage';\nexport { default as decodeImageFrame } from './decodeImageFrame';\nexport { default as decodeJPEGBaseline8BitColor } from './decodeJPEGBaseline8BitColor';\nexport { default as getImageFrame } from './getImageFrame';\nexport { default as getMinMax } from './getMinMax';\nexport { default as isColorImage } from './isColorImage';\nexport { default as isJPEGBaseline8BitColor } from './isJPEGBaseline8BitColor';\nexport { default as webWorkerManager } from './webWorkerManager';\nexport { default as version } from '../version';\nexport { internal } from './internal/';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/index.js","import $ from 'jquery';\nimport { getOptions } from './options';\nimport * as cornerstone from 'cornerstone-core';\n\nfunction xhrRequest (url, imageId, headers = {}) {\n  const deferred = $.Deferred();\n  const options = getOptions();\n\n  // Make the request for the DICOM P10 SOP Instance\n  const xhr = new XMLHttpRequest();\n\n  xhr.open('get', url, true);\n  xhr.responseType = 'arraybuffer';\n  options.beforeSend(xhr);\n  Object.keys(headers).forEach(function (key) {\n    xhr.setRequestHeader(key, headers[key]);\n  });\n\n  // handle response data\n  xhr.onreadystatechange = function () {\n    // TODO: consider sending out progress messages here as we receive the pixel data\n    if (xhr.readyState === 4) {\n      if (xhr.status === 200) {\n        deferred.resolve(xhr.response, xhr);\n      } else {\n        // request failed, reject the deferred\n        deferred.reject(xhr);\n      }\n    }\n  };\n  xhr.onprogress = function (oProgress) {\n    // console.log('progress:',oProgress)\n\n    if (oProgress.lengthComputable) {  // evt.loaded the bytes browser receive\n      // evt.total the total bytes seted by the header\n      //\n      const loaded = oProgress.loaded;\n      const total = oProgress.total;\n      const percentComplete = Math.round((loaded / total) * 100);\n\n      $(cornerstone.events).trigger('CornerstoneImageLoadProgress', {\n        imageId,\n        loaded,\n        total,\n        percentComplete\n      });\n    }\n  };\n\n  xhr.send();\n\n  return deferred.promise();\n}\n\nexport default xhrRequest;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/internal/xhrRequest.js","import $ from 'jquery';\nimport * as cornerstone from 'cornerstone-core';\nimport metaDataManager from './metaDataManager';\nimport getPixelData from './getPixelData';\nimport createImage from '../createImage';\n\nfunction getTransferSyntaxForContentType (/* contentType */) {\n  return '1.2.840.10008.1.2'; // hard code to ILE for now\n}\n\n/**\n *\n * @param {string} imageId\n * @param {Object} options\n * @returns {Deferred}\n */\nexport default function loadImage (imageId, options) {\n  const start = new Date().getTime();\n\n  const deferred = $.Deferred();\n\n  const uri = imageId.substring(7);\n\n  // check to make sure we have metadata for this imageId\n  const metaData = metaDataManager.get(imageId);\n\n  if (metaData === undefined) {\n    deferred.reject(`no metadata for imageId ${imageId}`);\n\n    return deferred.promise();\n  }\n\n  // TODO: load bulk data items that we might need\n\n  const mediaType = 'multipart/related; type=\"application/octet-stream\"'; // 'image/dicom+jp2';\n\n  // get the pixel data from the server\n  getPixelData(uri, imageId, mediaType).then(function (result) {\n\n    const transferSyntax = getTransferSyntaxForContentType(result.contentType);\n    const pixelData = result.imageFrame.pixelData;\n    const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      // add the loadTimeInMS property\n      const end = new Date().getTime();\n\n      image.loadTimeInMS = end - start;\n      deferred.resolve(image);\n    });\n  }).fail(function (reason) {\n    deferred.reject(reason);\n  });\n\n  return deferred;\n}\n\n// register wadors scheme\ncornerstone.registerImageLoader('wadors', loadImage);\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/loadImage.js","import getValue from './getValue';\n\n/**\n * Returns the first string value as a Javascript number\n *\n * @param element - The javascript object for the specified element in the metadata\n * @param {Number} [index] - the index of the value in a multi-valued element, default is 0\n * @param {*} [defaultValue] - The default value to return if the element does not exist\n * @returns {Number|Undefined}\n */\nexport default function (element, index, defaultValue) {\n  const value = getValue(element, index, defaultValue);\n\n  if (value === undefined) {\n    return;\n  }\n\n  return parseFloat(value);\n}\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/getNumberString.js","export { default as getNumberString } from './getNumberString';\nexport { default as getNumberValue } from './getNumberValue';\nexport { default as getNumberValues } from './getNumberValues';\nexport { default as getValue } from './getValue';\nexport { default as metaDataProvider } from './metaDataProvider';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/index.js","import getNumberValues from './getNumberValues';\nimport getValue from './getValue';\nimport getNumberValue from './getNumberValue';\nimport metaDataManager from '../metaDataManager';\nimport * as dicomParser from 'dicom-parser';\nimport * as cornerstone from 'cornerstone-core';\n\nfunction metaDataProvider (type, imageId) {\n  const metaData = metaDataManager.get(imageId);\n\n  if (!metaData) {\n    return;\n  }\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: getValue(metaData['00080060']),\n      seriesInstanceUID: getValue(metaData['0020000e']),\n      seriesNumber: getNumberValue(metaData['00200011']),\n      studyInstanceUID: getValue(metaData['0020000d']),\n      seriesDate: dicomParser.parseDA(getValue(metaData['00080021'])),\n      seriesTime: dicomParser.parseTM(getValue(metaData['00080031'], 0, ''))\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: getNumberValue(metaData['00101010']),\n      patientSize: getNumberValue(metaData['00101020']),\n      patientWeight: getNumberValue(metaData['00101030'])\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: getNumberValues(metaData['00280030'], 2),\n      imageOrientationPatient: getNumberValues(metaData['00200037'], 6),\n      imagePositionPatient: getNumberValues(metaData['00200032'], 3),\n      sliceThickness: getNumberValue(metaData['00180050']),\n      sliceLocation: getNumberValue(metaData['00201041'])\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return {\n      samplesPerPixel: getNumberValue(metaData['00280002']),\n      photometricInterpretation: getValue(metaData['00280004']),\n      rows: getNumberValue(metaData['00280010']),\n      columns: getNumberValue(metaData['00280011']),\n      bitsAllocated: getNumberValue(metaData['00280100']),\n      bitsStored: getNumberValue(metaData['00280101']),\n      highBit: getValue(metaData['00280102']),\n      pixelRepresentation: getNumberValue(metaData['00280103']),\n      planarConfiguration: getNumberValue(metaData['00280006']),\n      pixelAspectRatio: getValue(metaData['00280034']),\n      smallestPixelValue: getNumberValue(metaData['00280106']),\n      largestPixelValue: getNumberValue(metaData['00280107']),\n      redPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281101']),\n      greenPaletteColorLookupTableDescriptor: getNumberValues(metaData['00281102']),\n      bluePaletteColorLookupTableDescriptor: getNumberValues(metaData['00281103']),\n      redPaletteColorLookupTableData: getNumberValues(metaData['00281201']),\n      greenPaletteColorLookupTableData: getNumberValues(metaData['00281202']),\n      bluePaletteColorLookupTableData: getNumberValues(metaData['00281203'])\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    return {\n      // TODO: VOI LUT Sequence\n      windowCenter: getNumberValues(metaData['00281050'], 1),\n      windowWidth: getNumberValues(metaData['00281051'], 1)\n    };\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      rescaleIntercept: getNumberValue(metaData['00281052']),\n      rescaleSlope: getNumberValue(metaData['00281053']),\n      rescaleType: getValue(metaData['00281054'])\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: getValue(metaData['00080016']),\n      sopInstanceUID: getValue(metaData['00080018'])\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    const radiopharmaceuticalInfo = getValue(metaData['00540016']);\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM(getValue(radiopharmaceuticalInfo['00181072'], 0, '')),\n        radionuclideTotalDose: getNumberValue(radiopharmaceuticalInfo['00181074']),\n        radionuclideHalfLife: getNumberValue(radiopharmaceuticalInfo['00181075'])\n      }\n    };\n  }\n\n}\n\ncornerstone.metaData.addProvider(metaDataProvider);\n\nexport default metaDataProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/metaData/metaDataProvider.js","/**\n * Convert a string to a Uint8Array\n *\n * @param {String} str An input string\n * @return {Uint8Array} The string converted to a Uint8Array\n */\nexport default function (str) {\n  const uint = new Uint8Array(str.length);\n\n  for (let i = 0, j = str.length; i < j; i++) {\n    uint[i] = str.charCodeAt(i);\n  }\n\n  return uint;\n}\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/stringToUint8Array.js","/**\n * Convert a Uint8Array to a String\n *\n * @param {Uint8Array} data\n * @param {Number} offset\n * @param {Number} length\n * \n * @return {string} The Uint8Array converted to a String\n */\nexport default function (data, offset, length) {\n  offset = offset || 0;\n  length = length || data.length - offset;\n  let str = '';\n\n  for (let i = offset; i < offset + length; i++) {\n    str += String.fromCharCode(data[i]);\n  }\n\n  return str;\n}\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadors/uint8ArrayToString.js","import $ from 'jquery';\nimport * as cornerstone from 'cornerstone-core';\nimport createImage from '../createImage';\nimport parseImageId from './parseImageId';\nimport dataSetCacheManager from './dataSetCacheManager';\nimport getEncapsulatedImageFrame from './getEncapsulatedImageFrame';\nimport getUncompressedImageFrame from './getUncompressedImageFrame';\nimport loadFileRequest from './loadFileRequest';\nimport { xhrRequest } from '../internal';\n\n/**\n * Add a decache callback function to clear out our dataSetCacheManager\n *\n * @param {Image} image\n */\nfunction addDecache (image) {\n  image.decache = function () {\n    // console.log('decache');\n    const parsedImageId = parseImageId(image.imageId);\n\n    dataSetCacheManager.unload(parsedImageId.url);\n  };\n}\n\n/**\n *\n * @param {DataSet} dataSet\n * @param {Number} frameIndex\n * @return {*}\n */\nfunction getPixelData (dataSet, frameIndex) {\n  const pixelDataElement = dataSet.elements.x7fe00010;\n\n  if (pixelDataElement.encapsulatedPixelData) {\n    return getEncapsulatedImageFrame(dataSet, frameIndex);\n  }\n\n  return getUncompressedImageFrame(dataSet, frameIndex);\n\n}\n\n/**\n *\n * @param dataSetPromise\n * @param imageId\n * @param frame\n * @param options\n * @return {*}\n */\nfunction loadImageFromPromise (dataSetPromise, imageId, frame, options) {\n\n  const start = new Date().getTime();\n\n  frame = frame || 0;\n  const deferred = $.Deferred();\n\n  dataSetPromise.then(function (dataSet/* , xhr*/) {\n    const pixelData = getPixelData(dataSet, frame);\n    const transferSyntax = dataSet.string('x00020010');\n    const loadEnd = new Date().getTime();\n    const imagePromise = createImage(imageId, pixelData, transferSyntax, options);\n\n    imagePromise.then(function (image) {\n      image.data = dataSet;\n      const end = new Date().getTime();\n\n      image.loadTimeInMS = loadEnd - start;\n      image.totalTimeInMS = end - start;\n      addDecache(image);\n      deferred.resolve(image);\n    });\n  }, function (error) {\n    deferred.reject(error);\n  });\n\n  return deferred;\n}\n\n/**\n *\n * @param {String} scheme\n * @return {*}\n */\nfunction getLoaderForScheme (scheme) {\n  if (scheme === 'dicomweb' || scheme === 'wadouri') {\n    return xhrRequest;\n  } else if (scheme === 'dicomfile') {\n    return loadFileRequest;\n  }\n}\n\n/**\n * Load an imageId\n *\n * @param {String} imageId\n * @param {Object} options\n * @return {*}\n */\nfunction loadImage (imageId, options) {\n  const parsedImageId = parseImageId(imageId);\n  const url = parsedImageId.url;\n  let dataSet;\n\n  // if the dataset for this url is already loaded, use it\n  if (dataSetCacheManager.isLoaded(url)) {\n    dataSet = dataSetCacheManager.get(url);\n\n    return loadImageFromPromise(dataSet, imageId, parsedImageId.frame, options);\n  }\n\n  // load the dataSet via the dataSetCacheManager\n  const loader = getLoaderForScheme(parsedImageId.scheme);\n\n  dataSet = dataSetCacheManager.load(url, loader, imageId);\n\n  return loadImageFromPromise(dataSet, imageId, parsedImageId.frame, options);\n}\n\n// register dicomweb and wadouri image loader prefixes\ncornerstone.registerImageLoader('dicomweb', loadImage);\ncornerstone.registerImageLoader('wadouri', loadImage);\ncornerstone.registerImageLoader('dicomfile', loadImage);\n\nexport { loadImageFromPromise, getLoaderForScheme };\nexport default loadImage;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/loadImage.js","export { default as getImagePixelModule } from './getImagePixelModule';\nexport { default as getLUTs } from './getLUTs';\nexport { default as getModalityLUTOutputPixelRepresentation } from './getModalityLUTOutputPixelRepresentation';\nexport { default as getNumberValues } from './getNumberValues';\nexport { default as metaDataProvider } from './metaDataProvider';\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/index.js","import getNumberValues from './getNumberValues';\nimport parseImageId from '../parseImageId';\nimport dataSetCacheManager from '../dataSetCacheManager';\nimport getImagePixelModule from './getImagePixelModule';\nimport getLUTs from './getLUTs';\nimport getModalityLUTOutputPixelRepresentation from './getModalityLUTOutputPixelRepresentation';\nimport * as dicomParser from 'dicom-parser';\nimport * as cornerstone from 'cornerstone-core';\n\nfunction metaDataProvider (type, imageId) {\n  const parsedImageId = parseImageId(imageId);\n\n  if (!dataSetCacheManager.isLoaded(parsedImageId.url)) {\n    return;\n  }\n\n  const dataSet = dataSetCacheManager.get(parsedImageId.url);\n\n  if (type === 'generalSeriesModule') {\n    return {\n      modality: dataSet.string('x00080060'),\n      seriesInstanceUID: dataSet.string('x0020000e'),\n      seriesNumber: dataSet.intString('x00200011'),\n      studyInstanceUID: dataSet.string('x0020000d'),\n      seriesDate: dicomParser.parseDA(dataSet.string('x00080021')),\n      seriesTime: dicomParser.parseTM(dataSet.string('x00080031') || '')\n    };\n  }\n\n  if (type === 'patientStudyModule') {\n    return {\n      patientAge: dataSet.intString('x00101010'),\n      patientSize: dataSet.floatString('x00101020'),\n      patientWeight: dataSet.floatString('x00101030')\n    };\n  }\n\n  if (type === 'imagePlaneModule') {\n    return {\n      pixelSpacing: getNumberValues(dataSet, 'x00280030', 2),\n      imageOrientationPatient: getNumberValues(dataSet, 'x00200037', 6),\n      imagePositionPatient: getNumberValues(dataSet, 'x00200032', 3),\n      sliceThickness: dataSet.floatString('x00180050'),\n      sliceLocation: dataSet.floatString('x00201041'),\n      frameOfReferenceUID: dataSet.string('x00200052')\n    };\n  }\n\n  if (type === 'imagePixelModule') {\n    return getImagePixelModule(dataSet);\n  }\n\n  if (type === 'modalityLutModule') {\n    return {\n      rescaleIntercept: dataSet.floatString('x00281052'),\n      rescaleSlope: dataSet.floatString('x00281053'),\n      rescaleType: dataSet.string('x00281054'),\n      modalityLUTSequence: getLUTs(dataSet.uint16('x00280103'), dataSet.elements.x00283000)\n    };\n  }\n\n  if (type === 'voiLutModule') {\n    const modalityLUTOutputPixelRepresentation = getModalityLUTOutputPixelRepresentation(dataSet);\n\n\n    return {\n      windowCenter: getNumberValues(dataSet, 'x00281050', 1),\n      windowWidth: getNumberValues(dataSet, 'x00281051', 1),\n      voiLUTSequence: getLUTs(modalityLUTOutputPixelRepresentation, dataSet.elements.x00283010)\n    };\n  }\n\n  if (type === 'sopCommonModule') {\n    return {\n      sopClassUID: dataSet.string('x00080016'),\n      sopInstanceUID: dataSet.string('x00080018')\n    };\n  }\n\n  if (type === 'petIsotopeModule') {\n    const radiopharmaceuticalInfo = dataSet.elements.x00540016;\n\n    if (radiopharmaceuticalInfo === undefined) {\n      return;\n    }\n\n    const firstRadiopharmaceuticalInfoDataSet = radiopharmaceuticalInfo.items[0].dataSet;\n\n\n    return {\n      radiopharmaceuticalInfo: {\n        radiopharmaceuticalStartTime: dicomParser.parseTM(firstRadiopharmaceuticalInfoDataSet.string('x00181072') || ''),\n        radionuclideTotalDose: firstRadiopharmaceuticalInfoDataSet.floatString('x00181074'),\n        radionuclideHalfLife: firstRadiopharmaceuticalInfoDataSet.floatString('x00181075')\n      }\n    };\n  }\n\n}\n\n// register our metadata provider\ncornerstone.metaData.addProvider(metaDataProvider);\n\nexport default metaDataProvider;\n\n\n\n// WEBPACK FOOTER //\n// ./imageLoader/wadouri/metaData/metaDataProvider.js"],"sourceRoot":""}